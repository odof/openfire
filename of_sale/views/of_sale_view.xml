<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

<!--##############################################################################-->
<!--############################ ______ Ventes ______ ############################-->
<!--##############################################################################-->

        <!-- Filtres recherche devis / commande -->
        <record id="of_sale_view_devis_search" model="ir.ui.view">
            <field name="name">of.view.novagroupe.devis.search</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//search" position="inside">
                    <field name="of_etiquette_partenaire_ids" string="Étiquettes client" widget="many2one"/>
                </xpath>
            </field>
        </record>

        <record id="of_sale_order_view_search_inherit_sale" model="ir.ui.view">
            <field name="name">of.sale.order.search.inherit.sale</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_sale"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[3]" position="after">
                    <filter string="À facturer entièrement" domain="[('of_to_invoice','=',True)]"/>
                </xpath>
            </field>
        </record>

        <!-- Ajout etiquettes partenaire sur les devis -->
        <record id="of_sale_view_devis" model="ir.ui.view">
            <field name="name">of.sale.view.devis</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_crm.sale_view_inherit123"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='tag_ids']" position="after">
                    <field name="of_etiquette_partenaire_ids" widget="many2many_tags" readonly="1"/>
                </xpath>
            </field>
        </record>

        <!-- Ajout des droits sur les marges/prix d'achats -->
        <record id="of_sale_margin_sale_order_line" model="ir.ui.view">
            <field name="name">of.sale.margin.sale.order.line</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_margin.sale_margin_sale_order_line"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']/form//field[@name='purchase_price']" position="attributes">
                    <attribute name="groups">-base.group_user, of_sale.of_group_sale_marge_manager</attribute>
                    <attribute name="attrs">{'invisible': [('of_client_view', '=', True)]}</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']/form//field[@name='purchase_price']" position="after">
                    <field name="of_client_view" invisible="1"/>
                </xpath>
            </field>
        </record>

        <!-- Ajout des droits sur les marges/prix d'achats -->
        <record id="of_sale_margin_sale_order_line_form" model="ir.ui.view">
            <field name="name">of.sale.margin.sale.order.line.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_margin.sale_margin_sale_order_line_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']/tree//field[@name='purchase_price']" position="attributes">
                    <attribute name="groups">-base.group_user, of_sale.of_group_sale_marge_manager</attribute>
                    <attribute name="attrs">{'invisible': [('of_client_view', '=', True)]}</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']/tree" position="inside">
                    <field name="of_client_view" invisible="1"/>
                </xpath>
            </field>
        </record>

        <!-- Ajout des droits sur les marges/prix d'achats -->
        <record id="of_sale_margin_sale_order" model="ir.ui.view">
            <field name="name">of.sale.margin.sale.order</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_margin.sale_margin_sale_order"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='margin']" position="attributes">
                    <attribute name="groups">-base.group_user, of_sale.of_group_sale_marge_manager</attribute>
                    <attribute name="attrs">{'invisible': [('of_client_view', '=', True)]}</attribute>
                </xpath>
            </field>
        </record>


        <!-- Ajout champ frais de port product.product -->
        <record id="of_sale_view_order_form" model="ir.ui.view">
            <field name="name">of.sale.order.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="inside">
                    <button name="button_gestion_prix" type="object" string="Gestion prix" attrs="{'invisible': [('invoice_status', '=', 'invoiced')]}"/>
                </xpath>
                <xpath expr="//div[@name='button_box']" position="inside">
                    <!-- Ajout d'un bouton pour switcher entre vue client et vue vendeur' -->
                    <button name="toggle_view" type="object" class="oe_stat_button" icon="fa-pencil-square-o" groups="of_sale.of_group_sale_marge_manager">
                        <field name="of_client_view" widget="boolean_button"
                               options="{'terminology': {'string_true': 'Vue client',
                                                         'hover_true': 'Vue client',
                                                         'string_false': 'Vue vendeur',
                                                         'hover_false': 'Vue vendeur' }}"/>
                    </button>
                </xpath>
                <field name="date_order" position="attributes">
                    <attribute name="widget">date</attribute>
                </field>
                <!-- Ajout onglet Notes : client, facture, intervention -->
                <xpath expr="//notebook" position="inside">
                     <page string="Notes">
                        <!-- Notes client -->
                        <group attrs="{'invisible':[('of_notes_client','=',False)]}">
                            <separator string="Notes client" colspan="4"/>
                            <field name="of_notes_client" colspan="4" nolabel="1" readonly="1"
                                help="Ces notes proviennent de la fiche client sous la rubrique 'Notes internes'. Ils sont uniquement modifiables dans la fiche client."/>
                         </group>
                         <!-- Notes Facture -->
                        <separator string="Notes facture" colspan="4"/>
                        <field name="of_notes_facture" colspan="4" nolabel="1" widget="html"/>
                        <!-- Notes intervention -->
                        <separator string="Notes intervention" colspan="4"/>
                        <field name="of_notes_intervention" colspan="4" nolabel="1" widget="html"
                            help="Ces notes sont visualisées dans planning d'intervention et imprimées dans la fiche d'intervention."/>
                        <div class="oe_edit_only" colspan="4">
                            * Les données saisies dans ce champ seront visualisées dans planning d'intervention et imprimées dans la fiche d'intervention.
                        </div>
                     </page>
                </xpath>
                <!-- Ajout option Documents joints -->
                <xpath expr="//page//group[@name='technical']" position="after">
                    <separator string="Documents joints" colspan="4"/>
                    <field name="of_mail_template_ids" widget="many2many" nolabel="1"/>
                </xpath>
                <xpath expr="//field[@name='confirmation_date']" position="after">
                    <field name="of_date_vt"/>
                </xpath>
            </field>
        </record>

        <!-- Sale config wizard -->
        <record id="of_sale_view_sale_config_settings" model="ir.ui.view">
            <field name="name">of sale settings</field>
            <field name="model">sale.config.settings</field>
            <field name="inherit_id" ref="sale.view_sales_config"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='deposit_product_id_setting']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='deposit_product_id_setting']" position="after">
                    <field name="of_deposit_product_categ_id_setting" class="oe_inline"/>
                </xpath>
                <xpath expr="//div[@id='main']" position="inside">
                    <group name="rubrique_report" string="Devis &amp; commandes PDF">
                        <label for="pdf_adresse_civilite"/>
                        <div name="pdf_afficher_civilite">
                            <field name="pdf_adresse_civilite" class="oe_inline"/>
                            <span>Afficher la civilité dans les rapports PDF</span>
                        </div>
                        <label for="pdf_adresse_nom_parent"/>
                        <div name="pdf_afficher_nom_parent">
                            <field name="pdf_adresse_nom_parent" class="oe_inline"/>
                            <span>Remplacer le nom du contact par celui du parent dans les rapports PDF</span>
                        </div>
                        <label for="pdf_adresse_telephone"/>
                        <div name="pdf_afficher_telephone">
                            <field name="pdf_adresse_telephone" class="oe_inline"/>
                            <span>Afficher le numéro de téléphone dans les rapports PDF</span>
                        </div>
                        <label for="pdf_adresse_mobile"/>
                        <div name="pdf_adresse_mobile">
                            <field name="pdf_adresse_mobile" class="oe_inline"/>
                            <span>Afficher le numéro de mobile dans les rapports PDF</span>
                        </div>
                        <label for="pdf_adresse_fax"/>
                        <div name="pdf_afficher_fax">
                            <field name="pdf_adresse_fax" class="oe_inline"/>
                            <span>Afficher le fax dans les rapports PDF</span>
                        </div>
                        <label for="pdf_adresse_email"/>
                        <div name="pdf_afficher_email">
                            <field name="pdf_adresse_email" class="oe_inline"/>
                            <span>Afficher l'adresse email dans les rapports PDF</span>
                        </div>
                        <label for="pdf_display_product_ref_setting"/>
                        <div name="pdf_display_product_ref_setting">
                            <field name="pdf_display_product_ref_setting" class="oe_inline"/>
                            <span>Afficher les références produits dans les rapports PDF</span>
                        </div>
                        <label for="pdf_date_validite_devis"/>
                        <div name="pdf_date_validite_devis">
                            <field name="pdf_date_validite_devis" class="oe_inline"/>
                            <span>Afficher la date de validité dans le rapport PDF des devis</span>
                        </div>
                        <label for="of_color_bg_section"/>
                        <div name="of_color_bg_section_setting">
                            <field name="of_color_bg_section" class="oe_inline" widget="color"/>
                        </div>
                    </group>
                </xpath>
                <xpath expr="//group[@name='quotations_sales']" position="inside">
                    <label for="stock_warning_setting"/>
                    <div name="stock_warning_setting">
                        <field name="stock_warning_setting" class="oe_inline"/>
                        <span>Afficher les messages d'avertissement de stock</span>
                    </div>
                </xpath>
            </field>
        </record>

        <record id="of_sale_product_form_view" model="ir.ui.view">
            <field name="name">of.sale.product.form.view</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="of_product.of_product_product_form_view"/>
            <field name="arch" type="xml">
                <xpath expr="//group[@name='group_standard_price']/label[@for='of_seller_price']" position="attributes">
                    <attribute name="groups">of_sale.of_group_sale_marge_manager</attribute>
                </xpath>
                <xpath expr="//group[@name='group_standard_price']/div[1]" position="attributes">
                    <attribute name="groups">of_sale.of_group_sale_marge_manager</attribute>
                </xpath>
                <xpath expr="//group[@name='group_standard_price']/field[@name='of_seller_remise']" position="attributes">
                    <attribute name="groups">of_sale.of_group_sale_marge_manager</attribute>
                </xpath>
                <xpath expr="//group[@name='group_general']/label[@for='standard_price']" position="attributes">
                    <attribute name="groups">-base.group_user, of_sale.of_group_sale_marge_manager</attribute>
                </xpath>
                <xpath expr="//group[@name='group_general']/div[@name='standard_price_uom']" position="attributes">
                    <attribute name="groups">-base.group_user, of_sale.of_group_sale_marge_manager</attribute>
                </xpath>
                <xpath expr="//group[@name='group_general']/label[@for='marge']" position="attributes">
                    <attribute name="groups">of_sale.of_group_sale_marge_manager</attribute>
                </xpath>
                <xpath expr="//group[@name='group_general']/span" position="attributes">
                    <attribute name="groups">of_sale.of_group_sale_marge_manager</attribute>
                </xpath>
            </field>
        </record>

<!--##############################################################################-->
<!--########################### ______ Compta ______ #############################-->
<!--##############################################################################-->

    <!-- Add setting 'of_color_bg_section' to account settings -->
    <record id="of_account_config_settings_layouted_bg_color" model="ir.ui.view">
        <field name="name">of account settings</field>
        <field name="model">account.config.settings</field>
        <field name="inherit_id" ref="of_account_invoice_report.of_view_account_config_settings"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='pdf_display_product_ref']" position="after">
                <field name="of_color_bg_section" widget="color"/>
            </xpath>
        </field>
    </record>

    <!-- Ajout de la date visite technique dans la rubrique "Autres informations" de la vue formulaire de la facture -->
        <record id="of_account_invoice_view_form" model="ir.ui.view">
            <field name="name">of.account.invoice.view.form</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='date_due']" position="after">
                    <field name="of_date_vt"/>
                </xpath>
            </field>
        </record>

<!--##############################################################################-->
<!--########################### ______ Sociétés ______ ###########################-->
<!--##############################################################################-->

        <record id="of_sale_view_company_form" model="ir.ui.view">
            <field name="name">of.sale.company.form</field>
            <field name="model">res.company</field>
            <field name="inherit_id" ref="of_base.of_base_view_company_form" />
            <field name="arch" type="xml">
                <xpath expr="//notebook//page[@name='advanced_settings']" position="attributes">
                    <attribute name="invisible">0</attribute>
                </xpath>
                <xpath expr="//notebook//page[@name='advanced_settings']/group[@name='advanced_settings_group_2']" position="inside">
                    <group name="sales" colspan="2">
                        <separator string="Ventes" colspan="2"/>
                        <field name="afficher_descr_fab"/>
                    </group>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
