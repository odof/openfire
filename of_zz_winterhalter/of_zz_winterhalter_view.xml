<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

<!-- *************************************************** -->        
<!-- ****************** PARC INSTALLÉ ****************** -->
<!-- *************************************************** -->

		<!-- Parc installé filtre -->    
		<record id="of_parc_installe_search_view" model="ir.ui.view">
		    <field name="name">of.parc.installe.search</field>
		    <field name="model">of.parc.installe</field>
		    <field name="arch" type="xml">
		        <search string="Parc installé">
		            <field name="name"/>
		            <field name="product_id"/>
		            <field name="client_id"/>
		            <field name="tel_site_id"/>
		            <field name="date_service"/>
		            <field name="revendeur_id"/>
		            <group expand="0" string="Regrouper par">
		               <filter string="Client" icon="terp-personal" context="{'group_by' : 'client_id'}"/>
		               <filter string="Produit" icon="terp-personal" context="{'group_by' : 'product_id'}"/>
		               <filter string="Revendeur" icon="terp-personal" context="{'group_by' : 'revendeur_id'}"/>                  
		            </group>
		        </search>
		    </field>
		</record>

        <!-- Parc installé tree -->
        <record id="of_parc_installe_tree_view" model="ir.ui.view">
            <field name="name">of.parc.installe.tree</field>
            <field name="model">of.parc.installe</field>
            <field name="arch" type="xml">
                <tree string="Parc installé">
                    <field name="client_id"/>                    
                    <field name="product_id"/>
                    <field name="name"/>
                    <field name="site_adresse_id"/>
                    <field name="revendeur_id"/>
                    <field name="installateur_id"/>
                </tree>
            </field>
        </record>

        <!-- Parc installé form -->
        <record id="of_parc_installe_form_view" model="ir.ui.view">
            <field name="name">of.parc.installe.form</field>
            <field name="model">of.parc.installe</field>
            <field name="arch" type="xml">
	            <form>
	            	<group string="Client">
	            		<field name="client_id"/>
	            		<label for="site_adresse_id" string="Site installation"/>
		                <div>
		                    <field name="site_adresse_id" nolabel="1" context="{'show_address': True}"/>
			                <field name="street_site_id" nolabel="1"/>
			                <field name="street2_site_id" nolabel="1"/>
			                <field name="zip_site_id" style="width: 20%" nolabel="1"/>
			                <field name="city_site_id" style="width: 40%" nolabel="1"/>
			                <field name="country_site_id" nolabel="1"/>
			                <field name="tel_site_id" nolabel="1"/>
			            </div>
		            </group>
			        <group>
			            <group string="Produit installé">
			                <field name="product_id"/>
			                <field name="name"/>
			                <field name="date_service"/>
			                <field name="no_piece"/>
			                <field name="chiffre_aff_ht"/>
			                <field name="quantite_vendue"/>
			                <field name="marge"/>
			            </group>
			            <group string="Pose">
			           		<field name="revendeur_id"/>
			                <field name="installateur_id"/>
			                <!-- <field name="installateur_adresse_id" context="{'show_address': True}"/> -->             
			            </group>
		            </group>
		            <group>
		            	<field name="note"/>
		            </group>
	            </form>
            </field>
        </record>


<!-- *************************************************** -->        
<!-- *************** SAV (project.issue) *************** -->
<!-- *************************************************** --> 

		<!-- insertion Produit installé lié et champs supplémentaires Winterhalter dans SAV -->
		<record id="of_produit_installe_sav_lie" model="ir.ui.view" >
		    <field name="name">of.produit_installe.sav.lie</field>
		    <field name="model">project.issue</field>
		    <field name="inherit_id" ref="project_issue.project_issue_form_view"/>
		    <field name="arch" type="xml" >
		    	<field name="date" position="after">
		    		<field name="of_type"/>
		    	</field>
		    	<xpath expr='//form/sheet/group' position="after">
		            <group string="Produit installé" colspan="4">
		            	<field name="of_produit_installe_id" string="No de série"/>
		            	<field name="product_name_id"/>
		            	<field name="product_category_id"/>
		            </group>
		        </xpath>
		    </field>
		</record>


<!-- *************************************************** -->        
<!-- ********** VUE PARTENAIRES (res.partner) ********** -->
<!-- *************************************************** -->

        <!-- Vue partenaire filtre recherche ajout recherche par réf client -->
        <record id="of_res_partner_filter" model="ir.ui.view">
            <field name="name">of.res.partner.filter</field>
            <field name="model">res.partner</field>
            <field name="type">search</field>
            <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
            	<field name="name" position="after">
		            <field name="ref" string="Compte client"/>
				</field>
            </field>
        </record>
        
		<!-- Ajouter référence client dans liste partenaires -->
		<record id="of_res_partner_winterhalter_tree" model="ir.ui.view">
		   	<field name="name">of.res.partner.winterhalter.tree</field>
		    <field name="model">res.partner</field>
		    <field name="type">tree</field>
		    <field name="inherit_id" ref="base.view_partner_tree" />
		    <field name="arch" type="xml">
		      	<field name="display_name" position="before">
		            <field name="ref" string="Compte client"/>
				</field>
		    </field>
		</record>
		
		<!-- Mettre revendeur, installateur, payeur, référence client en haut dans formulaire partenaires -->
		<record id="of_res_partner_winterhalter_form" model="ir.ui.view">
		    <field name="name">of.res.partner.winterhalter.form</field>
		    <field name="model">res.partner</field>
		    <field name="inherit_id" ref="base.view_partner_form"/>
		    <field name="arch" type="xml">
		        <field name="user_id" position="after">
                    <field name="of_revendeur"/>
                    <field name="of_installateur"/>
                </field>
                <field name="website" position="after">
                    <field name="of_payeur_id" attrs="{'invisible': [('parent_id','!=', False)]}"/>
                </field>
                <field name="ref" position="replace"/>
		         <field name="type" position="before">
		            <field name="ref" string="Compte client" attrs="{'invisible': [('parent_id','!=', False)]}"/>
		        </field>
		        <field name="lang" position="after">
		            <field name="of_ape"/>
		        </field>
		        <group name="sav" position="replace">
	                <field name="project_issue_ids" nolabel="1" context="{'default_partner_id':id}">
	                    <tree string="SAV">
	                        <field name="of_code" string="Dossier"/>
	                        <field name="date"/>
	                        <field name="name" string="Requête"/>
	                        <field name="of_categorie_id" string="Famille"/>
	                        <field name="user_id" string="Responsable"/>
	                        <field name="of_piece_commande"/>
	                        <field name="stage_id"/>
	                        <button name="button_open_of_sav" class="oe_link" type="object" string="Ouvrir"/>
	                    </tree>
	                </field>
                </group>
		    </field>
		</record>



<!-- *************************************************** -->        
<!-- ********* VUE PRODUITS (product.template) ********* -->
<!-- *************************************************** -->

		<!-- Produits : ajout produit dangereux et poids ADR (poids produit dangereux) -->
		<record id="of_product_template_winterhalter_form" model="ir.ui.view">
		    <field name="name">of.product.template.winterhalter.form</field>
		    <field name="model">product.template</field>
		    <field name="inherit_id" ref="product.product_template_only_form_view"/>
		    <field name="arch" type="xml">
		        <field name="default_code" position="after">
		        	<field name="of_est_dangereux"/>
		        </field>
		        <div name="weight" position="after">
		        	<field name="of_poids_adr"/>
		        </div>
		    </field>
		</record>


<!-- *************************************************** -->        
<!-- ********************** MENUS ********************** -->
<!-- *************************************************** -->   
                
        <!-- Menu OpenService dans barre menu -->
		<menuitem id="menu_of_openservice" name="OpenService" sequence="0"/>
		     
		<!-- Action vue parc installé -->
		<record id="action_view_of_parc_installe" model="ir.actions.act_window">
		     <field name="name">Parc installé</field>
		     <field name="type">ir.actions.act_window</field>
		     <field name="res_model">of.parc.installe</field>
		     <field name="view_type">form</field>
		     <field name="view_mode">tree,form</field>
		     <field name="search_view_id" ref="of_parc_installe_search_view"/>
		     <field name="help">Parc des produits installés</field>
		</record>

		<!-- Menu parc installé -->
		<menuitem id="menu_of_parc_installe" action="action_view_of_parc_installe" name="Parc installé" 
		     parent="menu_of_openservice" sequence="10"/>
		     <!-- parent="base.menu_aftersale" groups="base.group_extended,base.group_sale_salesman" -->


		<!-- Menu SAV -->
	    <record model="ir.actions.act_window" id="of_project_issue_categ_act0">
	        <field name="name">SAV</field>
	        <field name="res_model">project.issue</field>
	        <field name="view_type">form</field>
	        <field name="view_mode">tree,kanban,calendar,form,pivot,graph</field>
	        <field name="view_id" ref="project_issue.project_issue_tree_view"/>
	        <field name="domain" eval=""/>
	        <!-- <field name="search_view_id" ref="view_project_issue_filter"/> -->
	        <field name="help" type="html">
	            <p>
	                The Odoo issues tacker allows you to efficiently manage things
	                like internal requests, software development bugs, customer
	                complaints, project troubles, material breakdowns, etc.
	            </p>
	        </field>
	    </record>

		<menuitem id="of_menu_project_issue_track"  parent="menu_of_openservice" action="of_project_issue_categ_act0" sequence="5"/>


		<!-- Menu Fournisseurs : on affiche ceux dont le champ supplier est vrai -->
		<record id="of_action_partner_supplier_form" model="ir.actions.act_window">
            <field name="name">Fournisseurs</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.partner</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="domain">[('supplier','=',True)]</field>
            <field name="context">{}</field>
            <!-- <field name="search_view_id" ref="view_res_partner_filter"/> -->
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
              </p><p>
                Odoo helps you easily track all activities related to
                a customer; discussions, history of business opportunities,
                documents, etc.
              </p>
            </field>
        </record>
        
        <!-- Menu Clients : on affiche tous les partenaires qui ne sont pas des fournisseurs ou à la fois fournisseur et client -->
        <record id="of_action_partner_form" model="ir.actions.act_window">
            <field name="name">Clients</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.partner</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="domain">['|',('supplier','=',False),('customer','=',True)]</field>
            <field name="context">{}</field>
            <!-- <field name="search_view_id" ref="view_res_partner_filter"/> -->
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
              </p><p>
                Odoo helps you easily track all activities related to
                a customer; discussions, history of business opportunities,
                documents, etc.
              </p>
            </field>
        </record>
        
        <menuitem id="of_menu_partner_form" parent="menu_of_openservice" action="of_action_partner_form" sequence="15"/>
        <menuitem id="of_menu_partner_supplier_form" parent="menu_of_openservice" action="of_action_partner_supplier_form" sequence="20"/>


		<!-- Menu Produits -->
		<record id="of_product_template_action" model="ir.actions.act_window">
            <field name="name">Produits</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">product.template</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="view_type">form</field>
            <!-- <field name="view_id" ref="product_template_kanban_view"/> -->
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to define a new product.
                </p><p>
                    You must define a product for everything you sell, whether it's a physical product, a consumable or a service you offer to  customers.               
                </p><p>
                    The product form contains information to simplify the sale process: price, notes in the quotation, accounting data, procurement methods, etc.
                </p>
            </field>
        </record>

        <menuitem id="of_menu_product_template_action" parent="menu_of_openservice" action="of_product_template_action" sequence="25"/>


<!-- *************************************************** -->        
<!-- ********************* ACTIONS ********************* -->
<!-- *************************************************** -->

		<!-- *** Action dans vue SAV (project.issue) *** -->
		
		<!-- Lien pour action créer SAV demande d'intervention depuis SAV-->
		<!-- Objectif : ouvrir un nouveau SAV depuis un SAV "Appel téléphonique" avec les mêmes paramètres mais avec type à "Demande d'intervention" -->
        <record id="action_open_demande_intervention" model="ir.actions.server">
            <field name="name">Effectuer une demande d'intervention</field>
            <field name="model_id" ref="project_issue.model_project_issue"/>
            <field name="state">code</field>
            <field name="code">action = self.pool['project.issue'].ouvrir_demande_intervention(cr, uid, context)</field>
        </record>

        <record id="action_create_demande_intervention" model="ir.values">
            <field name="name">Effectuer une demande d'intervention</field>
            <field name="key2">client_action_multi</field>
            <field name="model">project.issue</field>
            <field name="value" eval="'ir.actions.server,%d'%action_open_demande_intervention"/>
            <field name="object" eval="True"/>
        </record>


		<!-- *** Action dans vue parc installé (of.parc.installe) *** -->

		<!-- Lien pour action créer SAV depuis parc installé-->
        <record id="action_open_creer_sav" model="ir.actions.server">
            <field name="name">Créer un SAV</field>
            <field name="model_id" ref="project_issue.model_project_issue"/>
            <field name="state">code</field>
            <field name="code">action = self.pool['of.parc.installe'].action_creer_sav(cr, uid, context)</field>
        </record>

        <record id="action_create_demande_intervention" model="ir.values">
            <field name="name">Créer un SAV</field>
            <field name="key2">client_action_multi</field>
            <field name="model">of.parc.installe</field>
            <field name="value" eval="'ir.actions.server,%d'%action_open_creer_sav"/>
            <field name="object" eval="True"/>
        </record>

    </data>
</openerp>