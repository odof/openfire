<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

		<!-- Parc installé filtre -->    
		<record id="of_parc_installe_search_view" model="ir.ui.view">
		    <field name="name">of.parc.installe.search</field>
		    <field name="model">of.parc.installe</field>
		    <field name="arch" type="xml">
		        <search string="Parc installé">
		            <field name="name"/>
		            <field name="product_id"/>
		            <field name="client_id"/>
		            <field name="tel_site_id"/>
		            <field name="date_service"/>
		            <field name="revendeur_id"/>
		            <group expand="0" string="Regrouper par">
		               <filter string="Client" icon="terp-personal" context="{'group_by' : 'client_id'}"/>
		               <filter string="Produit" icon="terp-personal" context="{'group_by' : 'product_id'}"/>
		               <filter string="Revendeur" icon="terp-personal" context="{'group_by' : 'revendeur_id'}"/>                  
		            </group>
		        </search>
		    </field>
		</record>

        <!-- Parc installé tree -->
        <record id="of_parc_installe_tree_view" model="ir.ui.view">
            <field name="name">of.parc.installe.tree</field>
            <field name="model">of.parc.installe</field>
            <field name="arch" type="xml">
                <tree string="Parc installé">
                    <field name="client_id"/>                    
                    <field name="product_id"/>
                    <field name="name"/>
                    <field name="site_adresse_id"/>
                    <field name="revendeur_id"/>
                    <field name="installateur_id"/>
                </tree>
            </field>
        </record>

        <!-- Parc installé form -->
        <record id="of_parc_installe_form_view" model="ir.ui.view">
            <field name="name">of.parc.installe.form</field>
            <field name="model">of.parc.installe</field>
            <field name="arch" type="xml">
	            <form>
	            	<group string="Client">
	            		<field name="client_id"/>
	            		<label for="site_adresse_id" string="Site installation"/>
		                <div>
		                    <field name="site_adresse_id" nolabel="1" context="{'show_address': True}"/>
			                <field name="street_site_id" nolabel="1"/>
			                <field name="street2_site_id" nolabel="1"/>
			                <field name="zip_site_id" style="width: 20%" nolabel="1"/>
			                <field name="city_site_id" style="width: 40%" nolabel="1"/>
			                <field name="country_site_id" nolabel="1"/>
			                <field name="tel_site_id" nolabel="1"/>
			            </div>
		            </group>
			        <group>
			            <group string="Produit installé">
			                <field name="product_id"/>
			                <field name="name"/>
			                <field name="date_service"/>
			                <field name="no_piece"/>
			                <field name="chiffre_aff_ht"/>
			                <field name="quantite_vendue"/>
			                <field name="marge"/>
			            </group>
			            <group string="Pose">
			           		<field name="revendeur_id"/>
			                <field name="installateur_id"/>
			                <!-- <field name="installateur_adresse_id" context="{'show_address': True}"/> -->             
			            </group>
		            </group>
		            <group>
		            	<field name="note"/>
		            </group>
	            </form>
            </field>
        </record>
        
		<!-- Action vue parc installé -->
		<record id="action_view_of_parc_installe" model="ir.actions.act_window">
		     <field name="name">Parc installé</field>
		     <field name="type">ir.actions.act_window</field>
		     <field name="res_model">of.parc.installe</field>
		     <field name="view_type">form</field>
		     <field name="view_mode">tree,form</field>
		     <field name="search_view_id" ref="of_parc_installe_search_view"/>
		     <field name="help">Parc des produits installés</field>
		</record>
       
		<!-- Menu parc installé (Ventes/SAV/Parc installé) -->
		<menuitem id="menu_of_parc_installe" action="action_view_of_parc_installe" name="Parc installé" 
		     parent="base.menu_aftersale" sequence="20"/>
		     <!--  groups="base.group_extended,base.group_sale_salesman" -->
		
		
		<!-- insertion Produit installé lié et champs supplémentaires Winterhalter dans SAV -->
		<record id="of_produit_installe_sav_lie" model="ir.ui.view" >
		    <field name="name">of.produit_installe.sav.lie</field>
		    <field name="model">project.issue</field>
		    <field name="inherit_id" ref="project_issue.project_issue_form_view"/>
		    <field name="arch" type="xml" >
		    	<field name="date" position="after">
		    		<field name="of_type"/>
		    	</field>
		        <field name="email_from" position="after">
		         	<group string="Produit" colspan="4">
		            	<field name="of_produit_installe_id"/>
		            </group>
		        </field>
		    </field>
		</record>
		
		
		<!-- Lien pour action créer SAV demande d'intervention-->
		
        <record id="action_open_demande_intervention" model="ir.actions.server">
            <field name="name">Effectuer une demande d'intervention</field>
            <field name="model_id" ref="project_issue.model_project_issue"/>
            <field name="state">code</field>
            <field name="code">action = self.pool['project.issue'].ouvrir_demande_intervention(cr, uid, context)</field>
        </record>

        <record id="action_create_demande_intervention" model="ir.values">
            <field name="name">Effectuer une demande d'intervention</field>
            <field name="key2">client_action_multi</field>
            <field name="model">project.issue</field>
            <field name="value" eval="'ir.actions.server,%d'%action_open_demande_intervention"/>
            <field name="object" eval="True"/>
        </record>
     
        <!-- Vue partenaire filtre recherche ajout recherche par réf client -->
        <record id="of_res_partner_filter" model="ir.ui.view">
            <field name="name">of.res.partner.filter</field>
            <field name="model">res.partner</field>
            <field name="type">search</field>
            <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
            	<field name="name" position="after">
		            <field name="ref" string="Compte client"/>
				</field>
            </field>
        </record>
        
		<!-- Ajouter référence client dans liste partenaires -->
		<record id="of_res_partner_winterhalter_tree" model="ir.ui.view">
		   	<field name="name">of.res.partner.winterhalter.tree</field>
		    <field name="model">res.partner</field>
		    <field name="type">tree</field>
		    <field name="inherit_id" ref="base.view_partner_tree" />
		    <field name="arch" type="xml">
		      	<field name="display_name" position="before">
		            <field name="ref" string="Compte client"/>
				</field>
		    </field>
		</record>
		
		<!-- Mettre revendeur, installateur, payeur, référence client en haut dans formulaire partenaires -->
		<record id="of_res_partner_winterhalter_form" model="ir.ui.view">
		    <field name="name">of.res.partner.winterhalter.form</field>
		    <field name="model">res.partner</field>
		    <field name="inherit_id" ref="base.view_partner_form"/>
		    <field name="arch" type="xml">
		        <field name="user_id" position="after">
                    <field name="of_revendeur"/>
                    <field name="of_installateur"/>
                </field>
                <field name="website" position="after">
                    <field name="of_payeur_id" attrs="{'invisible': [('parent_id','!=', False)]}"/>
                </field>
                <field name="ref" position="replace"/>
		         <field name="type" position="before">
		            <field name="ref" string="Compte client" attrs="{'invisible': [('parent_id','!=', False)]}"/>
		        </field>
		        <field name="lang" position="after">
		            <field name="of_ape"/>
		        </field>
		    </field>
		</record>
		
		<!-- Produits : ajout produit dangereux et poids ADR (poids produit dangereux) -->
		<record id="of_product_template_winterhalter_form" model="ir.ui.view">
		    <field name="name">of.product.template.winterhalter.form</field>
		    <field name="model">product.template</field>
		    <field name="inherit_id" ref="product.product_template_only_form_view"/>
		    <field name="arch" type="xml">
		        <field name="default_code" position="after">
		        	<field name="of_est_dangereux"/>
		        </field>
		        <div name="weight" position="after">
		        	<field name="of_poids_adr"/>
		        </div>
		    </field>
		</record>

    </data>
</openerp>