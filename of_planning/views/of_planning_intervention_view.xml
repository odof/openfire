<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!--##############################################################################-->
<!--########################### ______ Employés ______ ###########################-->
<!--##############################################################################-->

    <!--Hr Employee inherit search view-->
    <record id="hr_employee_view_search_in_planning" model="ir.ui.view">
        <field name="name">hr.employee.search.view.inherit.planning</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='inactive']" position="after">
                <filter name="intervenants" string="Intervenants" domain="[('of_est_intervenant', '=', True)]"/>
            </xpath>
        </field>
    </record>

    <!-- Employee -->
    <record id="view_of_employee_form_intervention" model="ir.ui.view">
        <field name="name">of.hr.employee.form.intervention</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='job_id']" position="after">
                <field name="of_est_intervenant"/>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page name="interventions" string="Interventions" attrs="{'invisible': [('of_est_intervenant','=', False)]}">
                    <group>
                        <field name="of_equipe_ids" widget="many2many_tags"/>
                        <field name="of_toutes_taches"/>
                        <field name="of_tache_ids" widget="many2many" attrs="{'invisible': [('of_toutes_taches', '=', True)]}"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

<!--##########################################################################################################################-->
<!--#############################################______Historique du client______#############################################-->
<!--##########################################################################################################################-->

        <record id="of_planning_view_partner_form" model="ir.ui.view">
            <field name="name">of.planning.partner.form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form//div[@name='button_box']" position="inside">
                    <button class="oe_stat_button" name="action_view_interventions" type="object" icon="fa-calendar"
                      groups="of_planning.of_group_planning_intervention_lecture_tout">
                        <field string="RDVs Tech" name="intervention_count" widget="statinfo"/>
                    </button>
                </xpath>
                <page name="historique" position="inside">
                    <field name="id" invisible="1"/>
                    <group name="histo_interventions" string="Interventions">
                        <field name="intervention_partner_ids" colspan="4" nolabel="1" attrs="{'invisible': [('parent_id','!=', False)]}"
                               context="{'form_view_ref':'of_planning.of_planning_intervention_view_form2',
                                         'force_read': True}">
                            <tree string="Plannings">
                                <field name="tache_id"/>
                                <field name="employee_ids" widget="many2many_tags"/>
                                <field name="date" string="Date"/>
                                <field name="duree" string="Durée" widget="float_time"/>
                                <field name="state"/>
                                <field name="name" string="Libellé"/>
                                <field name="cleantext_description" string="Description"/>
                            </tree>
                        </field>
                        <field name="intervention_address_ids" colspan="4" nolabel="1" attrs="{'invisible': [('parent_id','=', False)]}"
                                context="{'form_view_ref':'of_planning.of_planning_intervention_view_form2', 'default_address_id':id,
                                          'force_read': True}">
                            <tree string="Plannings">
                                <field name="employee_ids" widget="many2many_tags"/>
                                <field name="tache_id"/>
                                <field name="date" string="Date"/>
                                <field name="duree" string="Durée" widget="float_time"/>
                                <field name="state"/>
                                <field name="name" string="Libellé"/>
                                <field name="cleantext_description" string="Description"/>
                                <field name="category_id"/>
                            </tree>
                        </field>
                    </group>
                </page>
            </field>
        </record>

<!--##########################################################################################################################-->
<!--############################################______Planning d'intervention______###########################################-->
<!--##########################################################################################################################-->

<!--##################################################______Recherche______###################################################-->
        <record id="of_planning_intervention_filter" model="ir.ui.view">
            <field name="name">of.planning.intervention.filter</field>
            <field name="model">of.planning.intervention</field>
            <field name="arch" type="xml">
                <search string="Recherche">
                    <group>
                        <filter string="Brouillon" name="state_draft" icon="terp-folder-violet" domain="[('state','=','draft')]"/>
                        <filter string="Confirmé" name="state_confirm" icon="gtk-no" domain="[('state','=','confirm')]"/>
                        <filter string="Réalisé" name="state_done" icon="terp-folder-blue" domain="[('state','=','done')]"/>
                        <filter string="Inachevé" name="state_unfinished" icon="terp-folder-blue" domain="[('state','=','unfinished')]"/>
                        <filter string="Annulé" name="state_cancel" icon="terp-dialog-close-red" domain="[('state','=','cancel')]"/>
                        <filter string="Reporté" name="state_postponed" icon="terp-folder-green" domain="[('state','=','postponed')]"/>
                        <separator/>
                        <filter string="Semaine en cours" name="this_week"
                                domain="[('date_deadline', u'&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')),
                                         ('date', u'&lt;', (context_today() + datetime.timedelta(days=7-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                        <filter string="Semaine prochaine" name="next_week"
                                domain="[('date_deadline', u'&gt;=', (context_today() + datetime.timedelta(days=7-context_today().weekday())).strftime('%Y-%m-%d')),
                                         ('date', u'&lt;', (context_today() + datetime.timedelta(days=14-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                        <filter string="Mois en cours" name="this_month"
                                domain="[('date_deadline', u'&gt;=', context_today().strftime('%Y-%m-01')),
                                         ('date', u'&lt;', (context_today() + relativedelta(day=1,months=1)).strftime('%Y-%m-%d'))]"/>
                        <filter string="Mois prochain" name="next_month"
                                domain="[('date_deadline', u'&gt;=', (context_today() + relativedelta(day=1,months=1)).strftime('%Y-%m-%d')),
                                         ('date', u'&lt;', (context_today() + relativedelta(day=1,months=2)).strftime('%Y-%m-%d'))]"/>
                        <filter string="Hier" name="yesterday"
                                domain="[(u'date', u'&gt;=', (context_today() - datetime.timedelta(days=1)).strftime('%Y-%m-%d')),
                                         (u'date', u'&lt;', context_today().strftime('%Y-%m-%d'))]"/>
                        <filter string="Aujourd'hui" name="today"
                                domain="[(u'date', u'&gt;=', current_date),
                                         (u'date', u'&lt;', (context_today() + datetime.timedelta(days=1)).strftime('%Y-%m-%d'))]"/>
                        <filter string="Demain" name="tomorrow"
                                domain="[(u'date', u'&gt;=', (context_today() + datetime.timedelta(days=1)).strftime('%Y-%m-%d')),
                                         (u'date', u'&lt;', (context_today() + datetime.timedelta(days=2)).strftime('%Y-%m-%d'))]"/>
                    </group>
                    <newline/>
                    <group>
                        <field name="name" filter_domain="['|', ('name','ilike',self), ('number','ilike',self)]"/>
                        <field name="date_date"/>
                        <field name="date_date" string="Semaine intervention"
                               context="{'of_date_search_mode':'week'}"/>
                        <field name="date_date" string="Mois intervention"
                               context="{'of_date_search_mode':'month'}"/>
                        <field name="duree"/>
                        <field name="tag_ids" widget="many2one"/>
                        <field name="user_id" widget="selection"/>
                        <field name="tache_id" widget="selection"/>
                        <field name="category_id" widget="selection"/>
                        <field name="equipe_id" widget="selection"/>
                        <field name="employee_ids"/>
                        <field name="address_id"/>
                        <field name="company_id" widget="selection"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Regrouper par...">
                       <filter string="Utilisateur" icon="terp-personal" domain="[]" context="{'group_by' : 'user_id'}"/>
                       <filter string="Tâche" icon="terp-folder-blue" domain="[]" context="{'group_by' : 'tache_id'}"/>
                       <filter string="Équipe" icon="terp-partner" domain="[]" context="{'group_by' : 'equipe_id'}"/>
                       <filter string="Intervenant" icon="terp-partner" domain="[]" context="{'group_by' : 'gb_employee_id'}"/>
                       <filter string="Magasin" icon="terp-go-home" domain="[]" context="{'group_by' : 'company_id'}"/>
                   </group>
                    <newline/>
                    <group expand="0" string="Recherche avancée">
                        <field name="id"/>
                        <field name="description"/>
                        <field name="raison_id"/>
                    </group>
                 </search>
            </field>
        </record>

<!--###################################################______Vue form______###################################################-->

        <record id="of_planning_intervention_view_form" model="ir.ui.view" >
            <field name="name">of.planning.intervention.form</field>
            <field name="model">of.planning.intervention</field>
            <field name="arch" type="xml" >
                <form string="Nouvelle Intervention">
                    <header>
                        Passer à
                        <button name="button_confirm" string="Confirmé" states="draft" type="object"/>
                        <button name="button_done" string="Réalisé" states="confirm" type="object"/>
                        <button name="button_unfinished" string="Inachevé" states="confirm" type="object"/>
                        <button name="button_postponed" string="Reporté" states="confirm" type="object"/>
                        <button name="button_cancel" string="Annulé" states="draft,confirm" type="object"/>
                        <button name="button_draft" string="Brouillon" states="confirm,done,unfinished,cancel,postponed" type="object"/>
                        <field name="state" widget="statusbar" nolabel="1" statusbar_visible="draft,confirm,done" statusbar_colors='{"proforma":"blue","proforma2":"blue"}'/>
                        <div align="right" style="align:right;padding: 0px 18px 0px 0px;width:100%">
                            <field name="raison_id" widget="selection" context="{'tz': 'Europe/Paris'}" attrs="{'invisible':[('state', '!=', 'postponed')]}"/>
                        </div>
                    </header>
                    <sheet>
                        <div class="oe_title" name="num">
                            <h1><b>
                                <span class="of_title">Rendez-vous d'intervention</span>
                                <field name="number" placeholder="N° d'intervention" readonly="1" nolabel="1" class="oe_inline"/>
                            </b></h1>
                        </div>
                        <group>
                            <group col="2" name="refs" string="Références">
                                <field name="equipe_id" autofocus="autofocus"/>
                                <field name="employee_ids" string="Intervenants" widget="many2many_tags" options='{"no_open": True, "no_create": True}'/>
                                <field name="partner_id" invisible="1"/>
                                <field name="address_id" domain="[('customer','=',True)]" colspan="2"/>
                                <field name="secteur_id"/>
                                <field name="user_id"/>
                                <field name="company_id" options="{'no_create': True, 'no_edit': True}"/>
                                <field name="name" string="Libellé"/>
                                <field name="tag_ids" widget="many2many_tags"/>
                            </group>
                            <group col="2" name="planif" string="Planification">
                                <field name="template_id" attrs="{'readonly': [('number', '!=', False), ('state', 'not in', ('draft', 'cancel'))]}"/>
                                <field name="tache_id"/>
                                <field name="forcer_dates"/>
                                <label for="date"/>
                                <div>
                                    <field name="jour" class="oe_inline of_ws"/>
                                    <field name="date" class="oe_inline"/>
                                </div>
                                <field name="duree" string="Durée" widget="float_time"/>
                                <label for="date_deadline" attrs="{'invisible': [('forcer_dates', '=', True)]}"/>
                                <div attrs="{'invisible': [('forcer_dates', '=', True)]}">
                                    <field name="jour_fin" class="oe_inline of_ws"/>
                                    <field name="date_deadline" class="oe_inline"/>
                                </div>
                                <label for="date_deadline_forcee" attrs="{'invisible': [('forcer_dates', '=', False)]}"/>
                                <div attrs="{'invisible': [('forcer_dates', '=', False)]}">
                                    <field name="jour_fin_force" class="oe_inline of_ws"/>
                                    <field name="date_deadline_forcee" class="oe_inline"
                                           attrs="{'required': [('forcer_dates', '=', True)]}"/>
                                </div>
                                <field name="verif_dispo"/>
                            </group>
                            <group name="liens">
                                <separator string="Documents liés" colspan="2"/>
                                <field name="order_id"
                                       groups="sales_team.group_sale_salesman,
                                               account.group_account_invoice,
                                               stock.group_stock_user,
                                               mrp.group_mrp_user"/>
                            </group>
                        </group>
                        <notebook>
                            <!-- Description -->
                            <page name="description" string="Descripton">
                                <field name="description" nolabel="1" witget="html"
                                    help="Ce champ sera imprimé dans la fiche d'intervention."/>
                                <div class="oe_edit_only" style="margin-top: -20px; padding-top: 0px">
                                    * Les données saisies dans ce champ seront imprimées dans la fiche d'intervention.
                                </div>
                            </page>
                            <page name="notes" string="Notes" attrs="{'invisible':[('of_notes_client','=',False),('of_notes_intervention','=',False)]}">
                                <group>
                                    <!-- Notes client -->
                                    <group attrs="{'invisible':[('of_notes_client','=',False)]}" col="2">
                                        <separator string="Notes client" colspan="2"/>
                                        <field name="of_notes_client" colspan="2" nolabel="1" readonly="1"
                                            help="Ces notes proviennent de la fiche client sous la rubrique 'Notes internes'. Ils sont uniquement modifiables dans la fiche client."/>
                                    </group>
                                    <!-- Notes intervention -->
                                    <group attrs="{'invisible':[('of_notes_intervention','=',False)]}" col="2">
                                        <separator string="Notes intervention" colspan="2"/>
                                        <field name="of_notes_intervention" nolabel="1"
                                            help="Ces notes proviennent du devis / commande sous la rubrique 'Notes intervention'. Ils sont uniquement modifiables dans le  devis / commande (voir la commande associée)."/>
                                    </group>
                                </group>
                            </page>
                            <!--page name="horaires" string="Horaires de travail">
                                <group colspan="4">
                                    <group>
                                        <field name="forcer_horaires"/>
                                        <field name="mode_horaires_readonly" attrs="{'invisible':[('forcer_horaires', '=', True)]}"/>
                                    </group>
                                    <group></group>
                                </group>
                                <group name="horaires_easy" attrs="{'invisible':[('forcer_horaires', '=', False), ('mode_horaires', '=', 'advanced')]}" colspan="4" col="4" >
                                    <separator string="Horaires" colspan="4"/>
                                    <group col="2" colspan="2">
                                        <label for="hor_md" string="Matin"/>
                                        <span class="oe_inline">
                                            <field class="oe_inline" name="hor_md" nolabel="1" widget="float_time" attrs="{'invisible':[('forcer_horaires', '=', False)], 'required': ['|', ('forcer_horaires', '=', True), ('mode_horaires', '=', 'easy')]}"/>
                                            <field class="oe_inline" name="hor_md_readonly" nolabel="1" widget="float_time" attrs="{'invisible':[('forcer_horaires', '=', True)]}"/> -
                                            <field class="oe_inline" name="hor_mf" nolabel="1" widget="float_time" attrs="{'invisible':[('forcer_horaires', '=', False)], 'required': ['|', ('forcer_horaires', '=', True), ('mode_horaires', '=', 'easy')]}"/>
                                            <field class="oe_inline" name="hor_mf_readonly" nolabel="1" widget="float_time" attrs="{'invisible':[('forcer_horaires', '=', True)]}"/>
                                        </span>
                                        <label for="hor_ad" string="Après-midi"/>
                                        <span class="oe_inline">
                                            <field class="oe_inline" name="hor_ad" nolabel="1" widget="float_time" attrs="{'invisible':[('forcer_horaires', '=', False)], 'required': ['|', ('forcer_horaires', '=', True), ('mode_horaires', '=', 'easy')]}"/>
                                            <field class="oe_inline" name="hor_ad_readonly" nolabel="1" widget="float_time" attrs="{'invisible':[('forcer_horaires', '=', True)]}"/> -
                                            <field class="oe_inline" name="hor_af" nolabel="1" widget="float_time" attrs="{'invisible':[('forcer_horaires', '=', False)], 'required': ['|', ('forcer_horaires', '=', True), ('mode_horaires', '=', 'easy')]}"/>
                                            <field class="oe_inline" name="hor_af_readonly" nolabel="1" widget="float_time" attrs="{'invisible':[('forcer_horaires', '=', True)]}"/>
                                        </span>
                                    </group>
                                    <group col="2" colspan="2">
                                        <field name="jour_ids" attrs="{'invisible':[('forcer_horaires', '=', False)], 'required': ['|', ('forcer_horaires', '=', True), ('mode_horaires', '=', 'easy')]}" widget="many2many_tags" colspan="2"/>
                                        <field name="jour_readonly_ids" attrs="{'invisible':[('forcer_horaires', '=', True)]}" widget="many2many_tags" colspan="2"/>
                                    </group>
                                </group>
                                <group col="4" name="horaires_advanced" attrs="{'invisible': ['|',('mode_horaires', '!=', 'advanced'), ('forcer_horaires', '=', True)]}">
                                    <group name="horaires_defaut" col="4" colspan="2">
                                        <separator string="Horaires par défaut" attrs="{'invisible':[('of_creneau_temp_start', '=', False)]}" colspan="4"/>
                                        <separator string="Horaires" attrs="{'invisible':[('of_creneau_temp_start', '!=', False)]}" colspan="4"/>
                                        <field name="of_creneau_readonly_ids" nolabel="1" colspan="4" style="padding: 8px;">
                                            <tree string="Créneaux" editable="0">
                                                <field name="jour_number" invisible="1"/>
                                                <field name="name"/>
                                                <field name="jour_id" invisible="1"/>
                                                <field name="heure_debut" invisible="1" widget="float_time"/>
                                                <field name="heure_fin" invisible="1" widget="float_time"/>
                                            </tree>
                                        </field>
                                    </group>
                                    <group name="horaires_temp" attrs="{'invisible':[('of_creneau_temp_start','=',False)]}" col="4" colspan="2">
                                        <group col="4" colspan="4">
                                            <separator string="Horaires temporaires" colspan="4"/>
                                            <field name="of_creneau_temp_start_readonly" string="Début de validité" attrs="{'required': [('of_creneau_temp_stop', '!=', False)]}"/>
                                            <field name="of_creneau_temp_stop_readonly" string="Fin de validité" attrs="{'required': [('of_creneau_temp_start', '!=', False)]}"/>
                                        </group>
                                        <field name="of_creneau_temp_readonly_ids" nolabel="1" colspan="4" style="padding: 8px;">
                                            <tree string="Créneaux" editable="0">
                                                <field name="jour_number" invisible="1"/>
                                                <field name="name"/>
                                                <field name="jour_id" invisible="1"/>
                                                <field name="heure_debut" invisible="1" widget="float_time"/>
                                                <field name="heure_fin" invisible="1" widget="float_time"/>
                                            </tree>
                                        </field>
                                    </group>
                                </group>
                                <field name="of_creneau_ids" invisible="1" widget="many2many_tags"/>
                                <field name="of_creneau_temp_start" invisible="1"/>
                                <field name="of_creneau_temp_stop" invisible="1"/>
                                <field name="of_creneau_temp_ids" invisible="1" widget="many2many_tags"/>
                                <field name="mode_horaires" invisible="1"/>
                            </page-->
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

    <record id="of_planning_intervention_view_form2" model="ir.ui.view" >
        <field name="name">of.planning.intervention.form2</field>
        <field name="model">of.planning.intervention</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning.of_planning_intervention_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='address_id']" position="attributes">
                <attribute name="domain">['&amp;', ('customer', '=', True), '|', ('id', '=', parent.id), ('parent_id', '=', parent.id)]</attribute>
            </xpath>
        </field>
    </record>

<!--###################################################______Vue tree______###################################################-->

        <record id="of_planning_intervention_view_tree" model="ir.ui.view" >
            <field name="name">of.planning.intervention.tree</field>
            <field name="model">of.planning.intervention</field>
            <field name="arch" type="xml" >
                <tree string="Liste des interventions" colors="darkolivegreen:state=='confirm';grey:state=='cancel';darkred:state=='postponed';darkblue:state=='done';purple:state=='unfinished'">
                    <field name="name" string="Libellé"/>
                    <field name="user_id" invisible="1"/>
                    <field name="date"/>
                    <field name="date_deadline" string="Deadline" invisible="1"/>
                    <field name="duree" string="Durée" widget="float_time"/>
                    <field name="employee_ids" widget="many2many_tags"/>
                    <field name="tache_id"/>
                    <field name="address_id"/>
                    <field name="address_city"/>
                    <field name="company_id"/>
                    <field name="state"/>
                    <field name="tag_ids" widget="many2many_tags"/>
                    <field name="cleantext_description" string="Description"/>
                </tree>
            </field>
        </record>

<!--#############################################______Vue calendar_______#####################################################-->

        <record id="of_planning_intervention_view_calendar" model="ir.ui.view">
            <field name="name">of.planning.intervention.calendar</field>
            <field name="model">of.planning.intervention</field>
            <field name="arch" type="xml">
                <!-- À vérifier  -->
                <calendar string="Calendrier" date_start="date" color="employee_ids" attendee="employee_ids" date_stop="date_deadline" display_states="1" quick_add="0"
                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1" color_is_attendee="1">
                    <field name="calendar_name"/>
                    <field name="state" invisible="1"/>
                    <field name="state_int" invisible="1"/>
                    <field name="of_color_ft" invisible="1"/>
                    <field name="of_color_bg" invisible="1"/>
                    <!--field name="color" invisible="1"/>
                    <field name="sidebar_color" invisible="1"/-->
                </calendar>
            </field>
        </record>
<!--##########################################################################################################################-->
<!--###########################################_________Étiquettes_________###################################################-->
<!--##########################################################################################################################-->

<!--#############################################_______Recherche_________#####################################################-->
        <record id="of_planning_tag_filter" model="ir.ui.view">
            <field name="name">of.planning.tag.filter</field>
            <field name="model">of.planning.tag</field>
            <field name="arch" type="xml">
                <search string="Recherche">
                    <field name="name"/>
                    <separator/>
                    <filter string="Active" name="active" domain="[('active','=',True)]"/>
                    <filter string="Archivée" name="inactive" domain="[('active','=',False)]"/>
                </search>
            </field>
        </record>

<!--#############################################_______Vue form_________#####################################################-->

        <record id="of_planning_tag_view_form" model="ir.ui.view" >
            <field name="name">of.planning.tag.form</field>
            <field name="model">of.planning.tag</field>
            <field name="arch" type="xml" >
                <form>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="toggle_active" type="object"
                                    class="oe_stat_button" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <label class="oe_edit_only" for="name" string="Nom"/>
                            <h1><field name="name" placeholder="nom de l'étiquette"/></h1>
                        </div>
                    </sheet>
                </form>
            </field>
        </record>

<!--#############################################_______Vue tree_________#####################################################-->

        <record id="of_planning_tag_view_tree" model="ir.ui.view" >
            <field name="name">of.planning.tag.tree</field>
            <field name="model">of.planning.tag</field>
            <field name="arch" type="xml" >
                <tree string="Liste des Étiquettes" colors="grey: active == False">
                    <field name="name" string="Libellé"/>
                    <field name="active" invisible="1"/>
                </tree>
            </field>
        </record>

<!--##########################################################################################################################-->
<!--#############################################_________Tâches_________#####################################################-->
<!--##########################################################################################################################-->

<!--#############################################_______Recherche_________#####################################################-->
        <record id="of_planning_tache_filter" model="ir.ui.view">
            <field name="name">of.planning.tache.filter</field>
            <field name="model">of.planning.tache</field>
            <field name="arch" type="xml">
                <search string="Recherche">
                    <group>
                        <field name="name"/>
                        <field name="is_crm"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Recherche avancée">
                        <field name="id"/>
                        <field name="description"/>
                    </group>
                 </search>
            </field>
        </record>

<!--#############################################_______Vue form_________#####################################################-->

        <record id="of_planning_tache_view_form" model="ir.ui.view" >
            <field name="name">of.planning.tache.form</field>
            <field name="model">of.planning.tache</field>
            <field name="arch" type="xml" >
                <form class="oe_form_configuration">
                    <header></header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="toggle_active" type="object"
                                    class="oe_stat_button" icon="fa-archive"
                                    confirm="Êtes-vous sûr de vouloir archiver/activer cette tâche ?">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <label for="name" string="Libellé" class="oe_edit_only" attrs="{'readonly':[('verr', '=', True)]}"/>
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <!--field name="employee_nb"/-->
                                <field name="product_id" string="Produit lié" attrs="{'readonly':[('verr', '=', True)]}"/>
                                <field name="tache_categ_id" options="{'no_create':True, 'no_open': True}"/>
                                <field name="category_id"/>
                                <field name="duree" widget="float_time"/>
                            </group>
                            <group>
                                <field name="is_crm"/>
                                <field name="imp_detail"/>
                            </group>
                            <group colspan="2">
                                <field name="description" attrs="{'readonly':[('verr', '=', True)]}"/>
                            </group>
                            <field name="verr" invisible="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="of_planning_tache_categ_view_form" model="ir.ui.view" >
            <field name="name">of.planning.tache.categ.form</field>
            <field name="model">of.planning.tache.categ</field>
            <field name="arch" type="xml" >
                <form class="oe_form_configuration">
                    <header></header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="toggle_active" type="object"
                                    class="oe_stat_button" icon="fa-archive"
                                    confirm="Êtes-vous sûr de vouloir archiver/activer cette tâche ?">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <label for="name" string="Libellé" class="oe_edit_only" attrs="{'readonly':[('verr', '=', True)]}"/>
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="tache_ids" widget="many2many"/>
                            </group>
                            <group>
                                <field name="sequence"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

<!--#############################################_______Vue tree_________#####################################################-->

        <record id="of_planning_tache_categ_view_tree" model="ir.ui.view" >
            <field name="name">of.planning.tache.categ.tree</field>
            <field name="model">of.planning.tache.categ</field>
            <field name="arch" type="xml" >
                <tree string="Liste des catégories de tâches" >
                    <field name="sequence" wdiget="handle"/>
                    <field name="name" string="Libellé"/>
                    <field name="tache_ids"/>
                    <field name="description"/>
                </tree>
            </field>
        </record>

        <record id="of_planning_tache_view_tree" model="ir.ui.view" >
            <field name="name">of.planning.tache.tree</field>
            <field name="model">of.planning.tache</field>
            <field name="arch" type="xml" >
                <tree string="Liste des tâches" >
                    <field name="name" string="Libellé"/>
                    <field name="tache_categ_id" string="Catégorie"/>
                    <field name="product_id"/>
                    <field name="category_id"/>
                    <field name="duree" widget="float_time"/>
                    <field name="description"/>
                </tree>
            </field>
        </record>

<!--##########################################################################################################################-->
<!--##############################################________Equipes________#####################################################-->
<!--##########################################################################################################################-->

<!--#############################################_______Recherche_________#####################################################-->

        <record id="of_planning_equipe_filter" model="ir.ui.view">
            <field name="name">of.planning.equipe.filter</field>
            <field name="model">of.planning.equipe</field>
            <field name="arch" type="xml">
                <search string="Recherche">
                    <group>
                        <filter name="filter_active" string="Désactivée" icon="terp-accessories-archiver" domain="[('active', '=', 0)]"/>
                        <field name="employee_ids"/>
                        <field name="name"/>
                        <field name="note"/>
                        <field name="category_ids"/>
                    </group>
                 </search>
            </field>
        </record>

<!--#############################################_______Vue tree_________#####################################################-->

        <record id="view_of_planning_equipe_tree" model="ir.ui.view">
            <field name="name">of.planning.equipe.tree</field>
            <field name="model">of.planning.equipe</field>
            <field name="arch" type="xml">
                <tree string="Liste des equipes" >
                    <field name="name" string="Equipe"/>
                    <!--field name="cout_horaire" string="Coût horaire"/>
                    <field name="cout_annuel" string="Coût annuel"/-->
                    <field name="employee_ids"/>
                    <!--field name="color_bg" widget="color"/-->
                    <field name="note"/>
                    <field name="sequence"/>
                    <!--field name="color_id"/-->
                </tree>
            </field>
        </record>

<!--#############################################_______Vue form_________#####################################################-->

        <record id="view_of_planning_equipe_form" model="ir.ui.view">
            <field name="name">of.planning.equipe.form</field>
            <field name="model">of.planning.equipe</field>
            <field name="arch" type="xml">
                <form class="oe_form_configuration">
                    <sheet>
                        <div class="oe_button_box" name="button_box" >
                            <!-- Bouton Actif -->
                            <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive" display="inline-block">
                                <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <label for="name" string="Equipe" class="oe_edit_only"/>
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group name="gr_1">
                            <group>
                                <field name="employee_ids" widget="many2many_tags"/>
                                <field name="sequence"/>
                            </group>
                            <field name="note" nolabel="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

<!--#############################################_______Raisons inacheve reporte________#####################################################-->

        <record id="of_planning_intervention_raison_form" model="ir.ui.view">
            <field name="name">of.planning.intervention.raison.form</field>
            <field name="model">of.planning.intervention.raison</field>
            <field name="arch" type="xml">
                <form string="Raison">
                    <group>
                        <field name="name" string="Libellé"/>
                    </group>
                </form>
            </field>
        </record>

        <record id="of_planning_intervention_raison_tree" model="ir.ui.view">
            <field name="name">of.planning.intervention.raison.tree</field>
            <field name="model">of.planning.intervention.raison</field>
            <field name="arch" type="xml">
                <tree string="Raison">
                    <field name="name" string="Libellé"/>
                </tree>
            </field>
        </record>

<!--##########################################################################################################################-->
<!--#############################################________Actions_________#####################################################-->
<!--##########################################################################################################################-->

        <record id="action_of_planning_intervention_calendar" model="ir.actions.act_window">
            <field name="name">Planning d'intervention</field>
            <field name="res_model">of.planning.intervention</field>
            <field name="view_type">form</field>
            <field name="view_mode">calendar,form,tree</field>
            <field name="context">{'search_default_state_confirm':1,'search_default_state_done':1,'search_default_state_draft':1,'search_default_state_unfinished':1}</field>
            <field name="view_id" ref="of_planning_intervention_view_calendar"/>
            <field name="search_view_id" ref="of_planning_intervention_filter"/>
        </record>

        <record id="action_of_planning_intervention_form" model="ir.actions.act_window">
            <field name="name">Planning d'intervention</field>
            <field name="res_model">of.planning.intervention</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="of_planning_intervention_view_form"/>
        </record>

        <record id="action_of_planning_tag_tree" model="ir.actions.act_window">
            <field name="name">Étiquettes d'intervention</field>
            <field name="res_model">of.planning.tag</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="of_planning_tag_view_tree"/>
            <field name="search_view_id" ref="of_planning_tag_filter"/>
        </record>


<!--#############################################______Copies d'actions_______#####################################################-->

        <!-- employés -->
        <record id="action_hr_employee_tree" model="ir.actions.act_window">
            <field name="name">Employés</field>
            <field name="res_model">hr.employee</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="hr.view_employee_tree"/>
            <field name="context">{
                'search_default_intervenants': 1,
            }</field>
        </record>

        <!-- équipes -->
        <record id="action_of_planning_equipe_tree" model="ir.actions.act_window">
            <field name="name">Equipes</field>
            <field name="res_model">of.planning.equipe</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_of_planning_equipe_tree"/>
        </record>

        <!-- catégories de tâches -->
        <record id="action_of_planning_tache_categ_tree" model="ir.actions.act_window">
            <field name="name">Catégories de tâches</field>
            <field name="res_model">of.planning.tache.categ</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="of_planning_tache_categ_view_tree"/>
        </record>

        <!-- tâches -->
        <record id="action_of_planning_tache_tree" model="ir.actions.act_window">
            <field name="name">Tâches</field>
            <field name="res_model">of.planning.tache</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="of_planning_tache_view_tree"/>
        </record>

        <!-- créneaux horaires -->
        <record id="action_view_of_horaire_creneau_tree_intervention" model="ir.actions.act_window">
            <field name="name">Créneaux horaires</field>
            <field name="res_model">of.horaire.creneau</field>
            <field name="view_type">form</field>
            <field name="view_mode">form,tree</field>
            <field name="view_id" ref="of_calendar.view_of_horaire_creneau_tree"/>
            <field name="search_view_id" ref="of_calendar.view_of_horaire_creneau_filter"/>
        </record>

        <!-- secteurs -->
        <record id="action_of_secteur_tree_intervention" model="ir.actions.act_window">
            <field name="name">Secteurs</field>
            <field name="res_model">of.secteur</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="of_base_location.of_view_secteur_tree"/>
            <field name="search_view_id" ref="of_base_location.of_view_secteur_filter"/>
        </record>

        <!-- codes postaux des secteurs - ->
        <record id="action_of_secteur_zip_tree_intervention" model="ir.actions.act_window">
            <field name="name">CP des secteurs</field>
            <field name="res_model">of.secteur.zip</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="of_base_location.of_view_secteur_zip_tree"/>
            <field name="search_view_id" ref="of_base_location.of_view_secteur_zip_filter"/>
        </record-->

   <!--################################################_Raison inacheve reporte_######################################################-->

        <record id="action_of_planning_intervention_raison_tree" model="ir.actions.act_window">
            <field name="name">Erreurs</field>
            <field name="res_model">of.planning.intervention.raison</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="of_planning.of_planning_intervention_raison_tree"/>
        </record>


<!--##########################################################################################################################-->
<!--############################################_________Modèle__________#####################################################-->
<!--##########################################################################################################################-->

    <record id="of_planning_intervention_template_view_form" model="ir.ui.view">
        <field name="name">of.planning.intervention.template.view.form</field>
        <field name="model">of.planning.intervention.template</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_button_box of_width_600" name="button_box_custom" >
                        <!-- Bouton Actif -->
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive" display="inline-block">
                            <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1><field name="name" placeholder="Nom du modèle"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="code"/>
                            <field name="tache_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Configuration">
                            <group>
                                <field name="sequence_id" colspan="2"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="of_planning_intervention_template_view_tree" model="ir.ui.view">
        <field name="name">of.planning.intervention.template.view.tree</field>
        <field name="model">of.planning.intervention.template</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="tache_id"/>
            </tree>
        </field>
    </record>

    <record id="action_of_planning_intervention_template" model="ir.actions.act_window">
        <field name="name">Modèle d'intervention</field>
        <field name="res_model">of.planning.intervention.template</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="of_planning.of_planning_intervention_template_view_tree"/>
    </record>

<!--##########################################################################################################################-->
<!--#######################################________Actions Dupliquées_________################################################-->
<!--##########################################################################################################################-->

    <record id="of_product_template_action_planning" model="ir.actions.act_window">
        <field name="name">Produits</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="product.product_template_tree_view"/>
        <field name="context">{"search_default_filter_to_sell":1}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to define a new product.
            </p><p>
                You must define a product for everything you sell, whether it's a physical product, a consumable or a service you offer to customers.
            </p><p>
                The product form contains information to simplify the sale process: price, notes in the quotation, accounting data, procurement methods, etc.
            </p>
        </field>
    </record>

    <record id="of_template_open_kit_planning" model="ir.actions.act_window">
        <field name="name">Kits</field>
        <field name="res_model">product.template</field>
        <field name="domain">[('of_is_kit', '=', True)]</field>
        <field name="view_mode">tree, kanban, form</field>
        <field name="view_type">form</field>
        <field name="context">{"default_of_is_kit":1}</field>
    </record>
    <record id="of_template_open_kit_view_tree_planning" model="ir.actions.act_window.view">
        <field eval="0" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="of_kit.of_product_template_kit_tree"/>
        <field name="act_window_id" ref="of_template_open_kit_planning"/>
    </record>
    <record id="of_template_open_kit_view_kanban_planning" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="of_kit.of_kit_product_template_kanban_view"/>
        <field name="act_window_id" ref="of_template_open_kit_planning"/>
    </record>
    <record id="of_template_open_kit_view_form_planning" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" eval="False"/>
        <field name="act_window_id" ref="of_template_open_kit_planning"/>
    </record>

    <record id="action_of_partner_form_planning" model="ir.actions.act_window">
        <field name="name">Clients</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,map,form</field>
        <field name="context">{"search_default_customer":1}</field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to add a contact in your address book.
          </p><p>
            Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
          </p>
        </field>
    </record>

<!--##########################################################################################################################-->
<!--#############################################_________Menus__________#####################################################-->
<!--##########################################################################################################################-->

    <menuitem id="menu_of_planning" name="Interventions" groups="of_group_planning_intervention_lecture_siens" sequence="2" web_icon="of_planning,static/description/icon.png"/>

        <menuitem id="menu_of_planning_intervention" name="Interventions" parent="of_planning.menu_of_planning" groups="of_group_planning_intervention_lecture_siens" sequence="10"/>
            <menuitem id="menu_of_planning_intervention_calendar" name="Planning" parent="of_planning.menu_of_planning_intervention" sequence="1" action="action_of_planning_intervention_calendar"/>

        <menuitem id="menu_of_planning_clients" name="Clients" parent="of_planning.menu_of_planning" sequence="20"/>
            <menuitem id="menu_of_planning_clients_clients" name="Clients" parent="of_planning.menu_of_planning_clients" action="action_of_partner_form_planning" sequence="10"/>

        <menuitem id="menu_of_planning_vente" name="Articles" parent="of_planning.menu_of_planning" sequence="30"
                  groups="sales_team.group_sale_salesman,account.group_account_invoice,stock.group_stock_user,mrp.group_mrp_user"/>
            <menuitem id="menu_of_planning_vente_articles" name="Articles" parent="of_planning.menu_of_planning_vente" action="of_product_template_action_planning" sequence="10"/>
            <menuitem id="menu_of_planning_vente_kits" name="Kits" parent="of_planning.menu_of_planning_vente" action="of_template_open_kit_planning" sequence="20"/>

        <menuitem id="menu_of_planning_configuration" name="Configuration" parent="of_planning.menu_of_planning" groups="hr.group_hr_manager" sequence="100"/>
            <menuitem name="Modèles d'intervention" id="menu_of_planning_intervention_template" parent="of_planning.menu_of_planning_configuration" sequence="10" action="action_of_planning_intervention_template"/>
            <menuitem name="Modèles de courriers" id="menu_of_planning_mail_templates" parent="of_planning.menu_of_planning_configuration" sequence="70" action="of_gesdoc.action_of_mail_template_tree_all" />
            <menuitem name="Employés" id="menu_hr_employee_tree" parent="of_planning.menu_of_planning_configuration" sequence="80" action="action_hr_employee_tree"/>
            <menuitem name="Équipes" id="menu_of_planning_equipe_tree" parent="of_planning.menu_of_planning_configuration" sequence="90" action="action_of_planning_equipe_tree"/>
            <menuitem id="menu_hr_config_of_creneau_intervention" name="Créneaux horaires" parent="menu_of_planning_configuration" groups="hr.group_hr_manager" action="action_view_of_horaire_creneau_tree_intervention" sequence="95"/>
            <menuitem name="Erreurs" id="menu_of_planning_intervention_raison_tree" parent="of_planning.menu_of_planning_configuration" sequence="100" action="action_of_planning_intervention_raison_tree"/>
            <menuitem name="Catégories de tâches" id="menu_of_planning_tache_categ_tree" parent="of_planning.menu_of_planning_configuration" sequence="109" action="action_of_planning_tache_categ_tree"/>
            <menuitem name="Tâches" id="menu_of_planning_tache_tree" parent="of_planning.menu_of_planning_configuration" sequence="110" action="action_of_planning_tache_tree"/>
            <menuitem name="Étiquettes d'intervention" id="menu_of_planning_tag_tree" parent="of_planning.menu_of_planning_configuration" sequence="115" action="action_of_planning_tag_tree"/>
            <menuitem name="Secteurs" id="of_secteur_intervention_menu" parent="of_planning.menu_of_planning_configuration" action="action_of_secteur_tree_intervention" sequence="120"/>
            <!--menuitem name="CP des Secteurs" id="of_secteur_zip_intervention_menu" parent="of_planning.menu_of_planning_configuration" action="action_of_secteur_zip_tree_intervention" sequence="121"/-->

        <!-- Creation la facture depuis planning intervention -->

        <record id="action_of_create_invoice_intervention" model="ir.actions.server">
            <field name="name">Générer les factures</field>
            <field name="model_id" ref="model_of_planning_intervention"/>
            <field name="state">code</field>
            <field name="code">action = records.create_invoice()</field>
        </record>

        <record id="action_create_invoice_intervention" model="ir.values">
            <field name="name">Générer les factures</field>
            <field name="key2">client_action_multi</field>
            <field name="model">of.planning.intervention</field>
            <field name="value" eval="'ir.actions.server,%d'%action_of_create_invoice_intervention"/>
        </record>


<!--#################################_Ajout bouton interventions dans Devis_############################# -->

        <!-- Ajout bouton interventions dans devis -->
        <record id="of_sale_view_order_form" model="ir.ui.view">
            <field name="name">of.sale.order.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="/form/sheet/div[@name='button_box']/button[@name='action_view_invoice']" position="after">
                    <button class="oe_stat_button" name="action_view_interventions" type="object" icon="fa-calendar">
                        <field string="RDVs tech" name="intervention_count" widget="statinfo"/>
                    </button>
                </xpath>
            </field>
        </record>

        <!-- Action pour afficher liste d'interventions -->
        <record id="of_sale_order_open_interventions" model="ir.actions.act_window">
            <field name="name">Interventions</field>
            <field name="res_model">of.planning.intervention</field>
            <field name="domain">[]</field> <!-- Force empty -->
            <field name="view_type">form</field>
        </record>

</odoo>
