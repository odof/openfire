<?xml version="1.0"?>
<odoo>

    <!--*****************************************************************************************-->
    <!--***************************************Période planifiée*********************************-->
    <!--*****************************************************************************************-->

        <record id="view_of_periode_planifiee_form" model="ir.ui.view">
        <field name="name">of.periode.planifiee.form</field>
        <field name="model">of.periode.planifiee</field>
        <field name="arch" type="xml">
            <form string="Périodes planifiées">
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1><field name="name"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="type"/>
                            <field name="premier_jour"/>
                            <field name="dernier_jour"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Ressources">
                            <field name="technicien_ids">
                                <form>
                                    <div class="oe_title">
                                        <h1><field name="user_id" domain="[('share', '=', False)]" placeholder="Ressource"/></h1>
                                    </div>
                                    <group>
                                        <group>
                                            <field name="periode_id" invisible="1"/>
                                            <field name="type"/>
                                            <field name="temps_de_travail" widget="float_time"/>
                                            <field name="temps_restant_categ" widget="float_time"/>
                                            <field name="temps_restant_task" widget="float_time"/>
                                            <field name="temps_effectue" widget="float_time"/>
                                        </group>
                                    </group>
                                    <notebook>
                                        <page string="Planification">
                                            <field name="task_planning_ids" widget="one2many">
                                                <tree editable="bottom">
                                                    <field name="project_id"/>
                                                    <field name="task_id"/>
                                                    <field name="task_stage_id"/>
                                                    <field name="type_id"/>
                                                    <field name="duration"/>
                                                    <field name="notes"/>
                                                    <field name="state"/>
                                                </tree>
                                                <form>
                                                    <group>
                                                        <group>
                                                            <field name="project_id"/>
                                                            <field name="task_id"/>
                                                            <field name="task_stage_id"/>
                                                            <field name="type_id"/>
                                                        </group>
                                                        <group>
                                                            <field name="state"/>
                                                            <field name="duration"/>
                                                            <field name="notes"/>
                                                        </group>
                                                    </group>
                                                </form>
                                            </field>
                                        </page>
                                        <page string="Catégories">
                                            <field name="category_ids">
                                                <tree editable="bottom" default_order="name">
                                                    <field name="name" invisible="1"/>
                                                    <field name="categorie_id"/>
                                                    <field name="temps_prevu" widget="float_time"/>
                                                    <field name="temps_restant" widget="float_time"/>
                                                    <field name="periode_id" invisible="1"/>
                                                </tree>
                                            </field>
                                        </page>
                                    </notebook>
                                </form>
                                <tree colors="darkred:temps_effectue&gt;temps_de_travail;
                                darkolivegreen:temps_effectue==temps_de_travail" default_order="name">
                                    <field name="name" invisible="1"/>
                                    <field name="user_id"  domain="[('share', '=', False)]"/>
                                    <field name="type"/>
                                    <field name="temps_de_travail" widget="float_time"/>
                                    <field name="temps_restant_categ" widget="float_time"/>
                                    <field name="temps_restant_task" widget="float_time"/>
                                    <field name="temps_effectue" widget="float_time"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_of_periode_planifiee_tree" model="ir.ui.view">
        <field name="name">of.periode.planifiee.tree</field>
        <field name="model">of.periode.planifiee</field>
        <field name="arch" type="xml">
            <tree string="Périodes planifiées"
                  colors="green: planification_ok; darkred: planification_alert">
                <field name="planification_alert" invisible="1"/>
                <field name="planification_ok" invisible="1"/>
                <field name="name"/>
                <field name="premier_jour"/>
                <field name="cust_total_time" string="Total client" widget="float_time" style="background-color: red;"/>
                <field name="cust_planned_time" string="Planifié" widget="float_time"/>
                <field name="cust_remaining_task_time" string="RAP" widget="float_time"/>
                <field name="cust_planned_time_perc" string="% Planif."/>
                <field name="cust_done_time" string="Produit" widget="float_time"/>
                <field name="cust_done_time_perc" string="% Prod."/>
                <field name="tech_total_time" string="Total dev" widget="float_time"/>
                <field name="tech_planned_time" string="Planifié" widget="float_time"/>
                <field name="tech_remaining_task_time" string="RAP" widget="float_time"/>
                <field name="tech_planned_time_perc" string="% Planif."/>
                <field name="tech_done_time" string="Produit" widget="float_time"/>
                <field name="tech_done_time_perc" string="% Prod."/>
            </tree>
        </field>
    </record>

    <record id="view_of_periode_planifiee_search" model="ir.ui.view">
        <field name="name">of.periode.planifiee.search</field>
        <field name="model">of.periode.planifiee</field>
        <field name="arch" type="xml">
            <search string="Périodes planifiées">
                <field name="name"/>
                <field name="type"/>
                <field name="premier_jour"/>
                <field name="dernier_jour"/>
                <filter name="incoming" string="À venir" domain="[('dernier_jour', '>=', context_today().strftime('%Y-%m-%d'))]" />
                <group expand="0" string="Regrouper par...">
                    <filter string="Type" name="groupby_type" domain="[]" context="{'group_by':'type'}"/>
                    <filter string="Utilisateur" name="groupby_user" domain="[]" context="{'group_by':'gb_user_id'}"/>
                    <filter string="Catégories" name="groupby_categ" domain="[]" context="{'group_by':'gb_category_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_view_periode_planifiee" model="ir.actions.act_window">
        <field name="name">Période planifiées</field>
        <field name="res_model">of.periode.planifiee</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_incoming': 1}</field>
        <field name="search_view_id" ref="view_of_periode_planifiee_search"/>
    </record>

    <menuitem action="action_view_periode_planifiee" id="menu_action_view_periode_planifiee" parent="project.menu_project_management" sequence="1"/>

</odoo>
