<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- There is a lot of views in this file. -->
    <!-- The base form view just below is used and inherited in primary mode by the other views, -->
    <!-- to easily display the same wizard depending on the source model that call it, some settings or during the use -->
    <!-- of the the wizard by changind some search criteria. -->
    <!-- Sometime we wants to display the time slots by date, sometime by distance, sometime by duration, -->
    <!-- and sometime we don't want to display the next time slots available by date at all. -->

    <!-- Base form view of the wizard -->
    <record id="view_rdv_intervention_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.wizard.form</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Plan an Intervention">
                <script>
                    $(document).ready(function(){
                        // élargir le pop-up
                        $(".modal-dialog").width('80%');
                    });
                </script>
                <field name="service_id" invisible="1"/>
                <field name="partner_id" invisible="1"/>
                <field name="partner_address_id" invisible="1"/>
                <field name="company_id" invisible="1"/>
                <field name="zero_result" invisible="1"/>
                <field name="res_line_id" invisible="1"/>
                <field name="name" invisible="1"/>
                <field name="employee_id" domain="[('id', 'in', context.get('employee_domain',[]))]" invisible="1"/>
                <field name="date_propos" invisible="1"/>
                <field name="date_propos_hour" widget="float_time" invisible="1"/>
                <field name="date_next" invisible="1"/>
                <field name="description" nolabel="1" invisible="1"/>
                <field name="display_res" invisible="1"/>
                <field name="geo_lat" invisible="1"/>
                <field name="geo_lng" invisible="1"/>
                <field name="precision" invisible="1"/>
                <field name="can_show_more" invisible="1"/>
                <field name="map_line_id" invisible="1"/>
                <field name="map_tour_id" invisible="1"/>
                <field name="source_model" invisible="1"/>
                <field name="additional_records" invisible="1"/>
                <field name="additional_record_geojson_data" invisible="1"/>
                <group>
                    <group>
                        <field name="search_template_id" options="{'no_create': True, 'no_open':True}"/>
                    </group>
                </group>
                <notebook>
                    <page name="list_results" string="List">
                        <div name="slots_lists" style="display: flex;">
                            <group name="slots_by_distance_duration" string="Slots by distance / duration">
                                <!-- by default this view displays time slots by distance, this field is replaced in the other primary views below -->
                                <field name="by_distance_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                    <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                        <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                        <field name="weekday"/>
                                        <field name="date"/>
                                        <field name="employee_id"/>
                                        <field name="description" string="Créneau"/>
                                        <field name="distance_utile" string="Distance"/>
                                        <field name="duree_utile" string="Durée"/>
                                        <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                        <field name="allday" invisible="1"/>
                                        <field name="disponible" invisible="1"/>
                                        <field name="selected" invisible="1"/>
                                        <field name="tour_id" invisible="1"/>
                                        <field name="map_preview" invisible="1"/>
                                    </tree>
                                </field>
                            </group>
                            <group name="slots_by_date" string="Slots by date" style="margin-left: 10px;">
                                <field name="by_date_planning_tree_ids" mode="tree" colspan="2" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_date">
                                    <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                        <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                        <field name="weekday"/>
                                        <field name="date"/>
                                        <field name="employee_id"/>
                                        <field name="description" string="Créneau"/>
                                        <field name="distance_utile" string="Distance"/>
                                        <field name="duree_utile" string="Durée"/>
                                        <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                        <field name="allday" invisible="1"/>
                                        <field name="disponible" invisible="1"/>
                                        <field name="selected" invisible="1"/>
                                        <field name="map_preview" invisible="1"/>
                                    </tree>
                                </field>
                            </group>
                        </div>
                        <group col="2" colspan="2">
                            <field name="map_tour_line_ids" mode="map" nolabel="1"
                                context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form', 'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                        </group>
                        <div style="float: left; font-size: x-small;font-weight: bold;">
                            <field name="map_description_html"/>
                        </div>
                    </page>
                    <page name="calendar_results" string="Calendar">
                        <group col="2" colspan="2">
                            <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                                <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                        attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                        dispo_field="disponible" jump_to="selected" display_states="1"
                                        force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                        attendee="employee_cal_ids">
                                    <field name="name"/>
                                    <field name="distance_utile" suffix=" km"/>
                                    <field name="duree_utile" suffix=" min"/>
                                    <field name="state_int" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="force_color" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="of_color_ft" invisible="1"/>
                                    <field name="of_color_bg" invisible="1"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="employee_id" invisible="1"/>
                                </calendar>
                            </field>
                        </group>
                    </page>
                    <!-- This page should always be in last position -->
                    <page name="search_criteria" string="Search criteria">
                        <group col="2" colspan="2">
                            <field name="pre_employee_ids" widget="many2many_tags" context="{'tache_prio_id': tache_id}"/>
                            <field name="flexible" groups="of_planning.of_group_planning_intervention_flexibility"/>
                            <div attrs="{'invisible': [('flexible', '!=', True)]}" colspan="2">
                                <span><i>Si un RDV flexible se trouve sur les créneaux que vous choisissez, il passera en statut Reporté</i></span>
                            </div>
                            <field name="creer_recurrence" attrs="{'invisible': [('service_id', '!=', False)]}"/>
                        </group>
                        <group colspan="4" name="search_criteria">
                            <group col="2">
                                <field name="search_type"/>
                                <field name="search_mode"/>
                                <field name="tache_id"/>
                                <field name="duree" widget="float_time"/>
                            </group>
                            <group col="2">
                                <field name="search_period_in_days"/>
                                <field name="date_recherche_debut"/>
                                <field name="date_recherche_fin"/>
                                <field name="day_ids" widget="many2many_tags"/>
                            </group>
                        </group>
                    </page>
                </notebook>
                <footer>
                    <button name="button_calcul" string="Rechercher" type="object" colspan="4" class="btn-primary"
                            attrs="{'invisible': [('date_propos','!=',False)]}"/>
                    <button name="button_calcul" string="Rechercher" type="object" colspan="2" class="btn-default"
                            attrs="{'invisible': [('date_propos','=',False)]}"/>
                    <button name="action_show_more_results" string="More results" type="object" colspan="4" class="btn-default" attrs="{'invisible': [('can_show_more','=', False)]}"/>
                    <button name="button_next" string="Période suivante" type="object" colspan="2" class="btn-default"
                            attrs="{'invisible': [('display_res', '=', False)]}"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Added a primary view to hide "by date" time slots -->
    <record id="view_rdv_intervention_wo_date_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.wo.date.wizard.form</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='slots_by_date']" position="replace"/>
        </field>
    </record>

    <!-- Added a primary view to display "by duration" time slots instead of "by distance" time slots -->
    <record id="view_rdv_intervention_by_duration_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.by.duration.wizard.form</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='slots_by_distance_duration']//field[@name='by_distance_planning_tree_ids']" position="replace">
                <field name="by_duration_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                    <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                        <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                        <field name="weekday"/>
                        <field name="date"/>
                        <field name="employee_id"/>
                        <field name="description" string="Créneau"/>
                        <field name="distance_utile" string="Distance"/>
                        <field name="duree_utile" string="Durée"/>
                        <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                        <field name="allday" invisible="1"/>
                        <field name="disponible" invisible="1"/>
                        <field name="selected" invisible="1"/>
                        <field name="tour_id" invisible="1"/>
                        <field name="map_preview" invisible="1"/>
                    </tree>
                </field>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display "by duration" time slots instead of "by distance" time slots and to hide "by date" time slots -->
    <record id="view_rdv_intervention_by_duration_wo_date_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.by.duration.wo.date.wizard.form</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='slots_by_date']" position="replace"/>
            <xpath expr="//group[@name='slots_by_distance_duration']//field[@name='by_distance_planning_tree_ids']" position="replace">
                <field name="by_duration_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                    <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                        <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                        <field name="weekday"/>
                        <field name="date"/>
                        <field name="employee_id"/>
                        <field name="description" string="Créneau"/>
                        <field name="distance_utile" string="Distance"/>
                        <field name="duree_utile" string="Durée"/>
                        <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                        <field name="allday" invisible="1"/>
                        <field name="disponible" invisible="1"/>
                        <field name="selected" invisible="1"/>
                        <field name="tour_id" invisible="1"/>
                        <field name="map_preview" invisible="1"/>
                    </tree>
                </field>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display the calendar tab in first position -->
    <record id="view_rdv_intervention_calendar_1st_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.calendar.1st.wizard.form</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='list_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='calendar_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='search_criteria']" position="before">
                <page name="calendar_results" string="Calendar">
                    <group col="2" colspan="2" attrs="{'invisible':[('display_res','=', False)]}">
                        <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                            <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                    dispo_field="disponible" jump_to="selected" display_states="1"
                                    force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                    attendee="employee_cal_ids">
                                <field name="name"/>
                                <field name="distance_utile" suffix=" km"/>
                                <field name="duree_utile" suffix=" min"/>
                                <field name="state_int" invisible="1"/>
                                <field name="disponible" invisible="1"/>
                                <field name="force_color" invisible="1"/>
                                <field name="selected" invisible="1"/>
                                <field name="of_color_ft" invisible="1"/>
                                <field name="of_color_bg" invisible="1"/>
                                <field name="allday" invisible="1"/>
                                <field name="employee_id" invisible="1"/>
                            </calendar>
                        </field>
                    </group>
                </page>
                <page name="list_results" string="List">
                    <div name="slots_lists" style="display: flex;">
                        <group string="Slots by distance / duration">
                            <field name="by_distance_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="tour_id" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                        <group name="slots_by_date" string="Slots by date" style="margin-left: 10px;">
                            <field name="by_date_planning_tree_ids" mode="tree" colspan="2" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_date">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                    </div>
                    <group col="2" colspan="2">
                            <field name="map_tour_line_ids" mode="map" nolabel="1" context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form',  'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                    </group>
                    <div style="float: left; font-size: x-small;font-weight: bold;">
                        <field name="map_description_html"/>
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display the calendar tab in first position, "by distance" time slots and without "by date" time slots -->
    <record id="view_rdv_intervention_calendar_1st_wo_date_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.calendar.1st.wo.date.wizard.form</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='list_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='calendar_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='search_criteria']" position="before">
                <page name="calendar_results" string="Calendar">
                    <group col="2" colspan="2" attrs="{'invisible':[('display_res','=', False)]}">
                        <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                            <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                    dispo_field="disponible" jump_to="selected" display_states="1"
                                    force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                    attendee="employee_cal_ids">
                                <field name="name"/>
                                <field name="distance_utile" suffix=" km"/>
                                <field name="duree_utile" suffix=" min"/>
                                <field name="state_int" invisible="1"/>
                                <field name="disponible" invisible="1"/>
                                <field name="force_color" invisible="1"/>
                                <field name="selected" invisible="1"/>
                                <field name="of_color_ft" invisible="1"/>
                                <field name="of_color_bg" invisible="1"/>
                                <field name="allday" invisible="1"/>
                                <field name="employee_id" invisible="1"/>
                            </calendar>
                        </field>
                    </group>
                </page>
                <page name="list_results" string="List">
                    <div name="slots_lists" style="display: flex;">
                        <group string="Slots by distance / duration">
                            <field name="by_distance_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="tour_id" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                    </div>
                    <group col="2" colspan="2">
                        <field name="map_tour_line_ids" mode="map" nolabel="1" context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form',  'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                    </group>
                    <div style="float: left; font-size: x-small;font-weight: bold;">
                        <field name="map_description_html"/>
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display the calendar tab in first position, with "by duration" time slots instead of "by distance" time slots -->
    <record id="view_rdv_intervention_calendar_1st_by_duration_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.calendar.1st.by.duration.wizard.form</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='list_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='calendar_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='search_criteria']" position="before">
                <page name="calendar_results" string="Calendar">
                    <group col="2" colspan="2">
                        <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                            <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                    dispo_field="disponible" jump_to="selected" display_states="1"
                                    force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                    attendee="employee_cal_ids">
                                <field name="name"/>
                                <field name="distance_utile" suffix=" km"/>
                                <field name="duree_utile" suffix=" min"/>
                                <field name="state_int" invisible="1"/>
                                <field name="disponible" invisible="1"/>
                                <field name="force_color" invisible="1"/>
                                <field name="selected" invisible="1"/>
                                <field name="of_color_ft" invisible="1"/>
                                <field name="of_color_bg" invisible="1"/>
                                <field name="allday" invisible="1"/>
                                <field name="employee_id" invisible="1"/>
                            </calendar>
                        </field>
                    </group>
                </page>
                <page name="list_results" string="List">
                    <div name="slots_lists" style="display: flex;">
                        <group string="Slots by distance / duration">
                            <field name="by_duration_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="tour_id" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                        <group name="slots_by_date" string="Slots by date" style="margin-left: 10px;">
                            <field name="by_date_planning_tree_ids" mode="tree" colspan="2" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_date">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                    </div>
                    <group col="2" colspan="2">
                        <field name="map_tour_line_ids" mode="map" nolabel="1" context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form',  'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                    </group>
                    <div style="float: left; font-size: x-small;font-weight: bold;">
                        <field name="map_description_html"/>
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display the calendar tab in first position, "with the"by duration" time slots instead of "by distance" time slots and without "by date" time slots -->
    <record id="view_rdv_intervention_calendar_1st_by_duration_wo_date_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.calendar.1st.by.duration.wo.date.wizard.form</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='list_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='calendar_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='search_criteria']" position="before">
                <page name="calendar_results" string="Calendar">
                    <group col="2" colspan="2">
                        <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                            <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                    dispo_field="disponible" jump_to="selected" display_states="1"
                                    force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                    attendee="employee_cal_ids">
                                <field name="name"/>
                                <field name="distance_utile" suffix=" km"/>
                                <field name="duree_utile" suffix=" min"/>
                                <field name="state_int" invisible="1"/>
                                <field name="disponible" invisible="1"/>
                                <field name="force_color" invisible="1"/>
                                <field name="selected" invisible="1"/>
                                <field name="of_color_ft" invisible="1"/>
                                <field name="of_color_bg" invisible="1"/>
                                <field name="allday" invisible="1"/>
                                <field name="employee_id" invisible="1"/>
                            </calendar>
                        </field>
                    </group>
                </page>
                <page name="list_results" string="List">
                    <div name="slots_lists" style="display: flex;">
                        <group string="Slots by distance / duration">
                            <field name="by_duration_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="tour_id" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                    </div>
                    <group col="2" colspan="2">
                        <field name="map_tour_line_ids" mode="map" nolabel="1" context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form',  'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                    </group>
                    <div style="float: left; font-size: x-small;font-weight: bold;">
                        <field name="map_description_html"/>
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Views for the wizard called from Partner/Task/Issue forms-->
    <!-- Views for the wizard called from Partner/Task/Issue forms-->
    <!-- Views for the wizard called from Partner/Task/Issue forms-->
    <record id="view_rdv_intervention_complete_form_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.complete.form.wizard</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='calendar_results']" position="attributes">
                <attribute name="attrs">{'invisible': [('display_res', '=', False)]}</attribute>
            </xpath>
            <xpath expr="//notebook//page[@name='list_results']" position="attributes">
                <attribute name="attrs">{'invisible': [('display_res', '=', False)]}</attribute>
            </xpath>
            <xpath expr="//notebook//page[@name='search_criteria']" position="replace"/>
            <!-- This page should always be in last position -->
            <xpath expr="//notebook//page[last()]" position="after">
                <page name="search_criteria" string="Search criteria">
                    <group name="main">
                        <group name="who" string="Who" class="of_grey_background">
                            <group colspan="2">
                                <field name="pre_employee_ids" widget="many2many_tags" context="{'tache_prio_id': tache_id}"/>
                                <field name="partner_id" readonly="1"/>
                            </group>
                        </group>
                        <group name="when" string="When" class="of_grey_background">
                            <group colspan="2">
                                <field name="search_period_in_days"/>
                                <field name="date_recherche_debut"/>
                                <field name="date_recherche_fin"/>
                                <field name="day_ids" widget="many2many_tags"/>
                            </group>
                        </group>
                        <group name="what" string="What" class="of_grey_background">
                            <group colspan="2">
                                <field name="service_id"/>
                                <field name="template_id"/>
                                <field name="tache_id"/>
                                <field name="duree" widget="float_time"/>
                            </group>
                        </group>
                        <group name="how" string="How" class="of_grey_background">
                            <group colspan="2">
                                <field name="flexible" groups="of_planning.of_group_planning_intervention_flexibility"/>
                                <div attrs="{'invisible': [('flexible', '!=', True)]}" colspan="2">
                                    <span><i>Si un RDV flexible se trouve sur les créneaux que vous choisissez, il passera en statut Reporté</i></span>
                                </div>
                                <field name="creer_recurrence" attrs="{'invisible': [('service_id', '!=', False)]}"/>
                            </group>
                            <group colspan="2">
                                <field name="search_type"/>
                                <field name="search_mode"/>
                            </group>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to hide "by date" time slots -->
    <record id="view_rdv_intervention_complete_wo_date_form_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.complete.wo.date.form.wizard</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_complete_form_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='slots_by_date']" position="replace"/>
        </field>
    </record>

    <!-- Added a primary view to display "by duration" time slots instead of "by distance" time slots -->
    <record id="view_rdv_intervention_complete_form_by_duration_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.complete.form.by.duration.wizard</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_complete_form_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='slots_by_distance_duration']//field[@name='by_distance_planning_tree_ids']" position="replace">
                <field name="by_duration_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                    <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                        <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                        <field name="weekday"/>
                        <field name="date"/>
                        <field name="employee_id"/>
                        <field name="description" string="Créneau"/>
                        <field name="distance_utile" string="Distance"/>
                        <field name="duree_utile" string="Durée"/>
                        <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                        <field name="allday" invisible="1"/>
                        <field name="disponible" invisible="1"/>
                        <field name="selected" invisible="1"/>
                        <field name="tour_id" invisible="1"/>
                        <field name="map_preview" invisible="1"/>
                    </tree>
                </field>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display "by duration" time slots instead of "by distance" time slots and without "by date" time slots -->
    <record id="view_rdv_intervention_complete_form_by_duration_wo_date_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.complete.form.by.duration.wo.date.wizard</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_complete_form_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='slots_by_date']" position="replace"/>
            <xpath expr="//group[@name='slots_by_distance_duration']//field[@name='by_distance_planning_tree_ids']" position="replace">
                <field name="by_duration_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                    <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                        <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                        <field name="weekday"/>
                        <field name="date"/>
                        <field name="employee_id"/>
                        <field name="description" string="Créneau"/>
                        <field name="distance_utile" string="Distance"/>
                        <field name="duree_utile" string="Durée"/>
                        <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                        <field name="allday" invisible="1"/>
                        <field name="disponible" invisible="1"/>
                        <field name="selected" invisible="1"/>
                        <field name="tour_id" invisible="1"/>
                        <field name="map_preview" invisible="1"/>
                    </tree>
                </field>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display the calendar tab in first position -->
    <record id="view_rdv_intervention_complete_form_calendar_1st_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.complete.form.calendar.1st.wizard</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_complete_form_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='list_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='calendar_results']" position="replace"/>
            <xpath expr="//notebook//page[last()]" position="before">
                <page name="calendar_results" string="Calendar" attrs="{'invisible': [('display_res', '=', False)]}">
                    <group col="2" colspan="2">
                        <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                            <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                    dispo_field="disponible" jump_to="selected" display_states="1"
                                    force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                    attendee="employee_cal_ids">
                                <field name="name"/>
                                <field name="distance_utile" suffix=" km"/>
                                <field name="duree_utile" suffix=" min"/>
                                <field name="state_int" invisible="1"/>
                                <field name="disponible" invisible="1"/>
                                <field name="force_color" invisible="1"/>
                                <field name="selected" invisible="1"/>
                                <field name="of_color_ft" invisible="1"/>
                                <field name="of_color_bg" invisible="1"/>
                                <field name="allday" invisible="1"/>
                                <field name="employee_id" invisible="1"/>
                            </calendar>
                        </field>
                    </group>
                </page>
                <page name="list_results" string="List" attrs="{'invisible': [('display_res', '=', False)]}">
                    <div name="slots_lists" style="display: flex;">
                        <group string="Slots by distance / duration">
                            <field name="by_distance_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="tour_id" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                        <group name="slots_by_date" string="Slots by date" style="margin-left: 10px;">
                            <field name="by_date_planning_tree_ids" mode="tree" colspan="2" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_date">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                    </div>
                    <group col="2" colspan="2">
                        <field name="map_tour_line_ids" mode="map" nolabel="1" context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form',  'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                    </group>
                    <div style="float: left; font-size: x-small;font-weight: bold;">
                        <field name="map_description_html"/>
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display the calendar tab in first position and without "by date" time slots -->
    <record id="view_rdv_intervention_complete_form_calendar_1st_wo_date_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.complete.form.calendar.1st.wo.date.wizard</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_complete_form_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='list_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='calendar_results']" position="replace"/>
            <xpath expr="//notebook//page[last()]" position="before">
                <page name="calendar_results" string="Calendar" attrs="{'invisible': [('display_res', '=', False)]}">
                    <group col="2" colspan="2">
                        <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                            <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                    dispo_field="disponible" jump_to="selected" display_states="1"
                                    force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                    attendee="employee_cal_ids">
                                <field name="name"/>
                                <field name="distance_utile" suffix=" km"/>
                                <field name="duree_utile" suffix=" min"/>
                                <field name="state_int" invisible="1"/>
                                <field name="disponible" invisible="1"/>
                                <field name="force_color" invisible="1"/>
                                <field name="selected" invisible="1"/>
                                <field name="of_color_ft" invisible="1"/>
                                <field name="of_color_bg" invisible="1"/>
                                <field name="allday" invisible="1"/>
                                <field name="employee_id" invisible="1"/>
                            </calendar>
                        </field>
                    </group>
                </page>
                <page name="list_results" string="List" attrs="{'invisible': [('display_res', '=', False)]}">
                    <div name="slots_lists" style="display: flex;">
                        <group string="Slots by distance / duration">
                            <field name="by_distance_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="tour_id" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                    </div>
                    <group col="2" colspan="2">
                        <field name="map_tour_line_ids" mode="map" nolabel="1" context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form',  'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                    </group>
                    <div style="float: left; font-size: x-small;font-weight: bold;">
                        <field name="map_description_html"/>
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display the calendar tab in first position, with "by duration" time slots instead of "by distance" time slots -->
    <record id="view_rdv_intervention_complete_form_calendar_1st_by_duration_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.complete.form.calendar.1st.by.duration.wizard</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_complete_form_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='list_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='calendar_results']" position="replace"/>
            <xpath expr="//notebook//page[last()]" position="before">
                <page name="calendar_results" string="Calendar" attrs="{'invisible': [('display_res', '=', False)]}">
                    <group col="2" colspan="2">
                        <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                            <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                    dispo_field="disponible" jump_to="selected" display_states="1"
                                    force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                    attendee="employee_cal_ids">
                                <field name="name"/>
                                <field name="distance_utile" suffix=" km"/>
                                <field name="duree_utile" suffix=" min"/>
                                <field name="state_int" invisible="1"/>
                                <field name="disponible" invisible="1"/>
                                <field name="force_color" invisible="1"/>
                                <field name="selected" invisible="1"/>
                                <field name="of_color_ft" invisible="1"/>
                                <field name="of_color_bg" invisible="1"/>
                                <field name="allday" invisible="1"/>
                                <field name="employee_id" invisible="1"/>
                            </calendar>
                        </field>
                    </group>
                </page>
                <page name="list_results" string="List" attrs="{'invisible': [('display_res', '=', False)]}">
                    <div name="slots_lists" style="display: flex;">
                        <group string="Slots by distance / duration">
                            <field name="by_duration_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="tour_id" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                        <group name="slots_by_date" string="Slots by date" style="margin-left: 10px;">
                            <field name="by_date_planning_tree_ids" mode="tree" colspan="2" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_date">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                    </div>
                    <group col="2" colspan="2">
                        <field name="map_tour_line_ids" mode="map" nolabel="1" context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form',  'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                    </group>
                    <div style="float: left; font-size: x-small;font-weight: bold;">
                        <field name="map_description_html"/>
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Added a primary view to display the calendar tabin first position, "by duration" time slots instead of "by distance" time slots and without "by date" time slots -->
    <record id="view_rdv_intervention_complete_form_calendar_1st_by_duration_wo_date_wizard" model="ir.ui.view">
        <field name="name">view.of.tournee.rdv.complete.form.calendar.1st.by.duration.wo.date.wizard</field>
        <field name="model">of.tournee.rdv</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_rdv_intervention_complete_form_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook//page[@name='list_results']" position="replace"/>
            <xpath expr="//notebook//page[@name='calendar_results']" position="replace"/>
            <xpath expr="//notebook//page[last()]" position="before">
                <page name="calendar_results" string="Calendar" attrs="{'invisible': [('display_res', '=', False)]}">
                    <group col="2" colspan="2">
                        <field name="planning_ids" mode="calendar" colspan="4" nolabel="1" create="0">
                            <calendar string="Calendrier" date_start="debut_dt" color="employee_cal_ids" date_stop="fin_dt" all_day="allday"
                                    attendee_model="hr.employee" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1"
                                    dispo_field="disponible" jump_to="selected" display_states="1"
                                    force_color_field="force_color" selected_field="selected" quick_add="0" draggable="0"
                                    attendee="employee_cal_ids">
                                <field name="name"/>
                                <field name="distance_utile" suffix=" km"/>
                                <field name="duree_utile" suffix=" min"/>
                                <field name="state_int" invisible="1"/>
                                <field name="disponible" invisible="1"/>
                                <field name="force_color" invisible="1"/>
                                <field name="selected" invisible="1"/>
                                <field name="of_color_ft" invisible="1"/>
                                <field name="of_color_bg" invisible="1"/>
                                <field name="allday" invisible="1"/>
                                <field name="employee_id" invisible="1"/>
                            </calendar>
                        </field>
                    </group>
                </page>
                <page name="list_results" string="List" attrs="{'invisible': [('display_res', '=', False)]}">
                    <div name="slots_lists" style="display: flex;">
                        <group string="Slots by distance / duration">
                            <field name="by_duration_planning_tree_ids" mode="tree" nolabel="1" options="{'reload_on_button': true}" class="planning_tour_by_distance_duration">
                                <tree limit="5" create="false" delete="false" readonly="1" colors="green: selected==True; orange: map_preview==True">
                                    <button name="action_view_tour" type="object" icon="fa-map-marker" help="Show Tour of the day for this employee on the map"/>
                                    <field name="weekday"/>
                                    <field name="date"/>
                                    <field name="employee_id"/>
                                    <field name="description" string="Créneau"/>
                                    <field name="distance_utile" string="Distance"/>
                                    <field name="duree_utile" string="Durée"/>
                                    <button name="action_select_confirm_slot" type="object" icon="fa-check" help="Select and confirm this slot"/>
                                    <field name="allday" invisible="1"/>
                                    <field name="disponible" invisible="1"/>
                                    <field name="selected" invisible="1"/>
                                    <field name="tour_id" invisible="1"/>
                                    <field name="map_preview" invisible="1"/>
                                </tree>
                            </field>
                        </group>
                    </div>
                    <group col="2" colspan="2">
                        <field name="map_tour_line_ids" mode="map" nolabel="1" context="{'form_view_ref':'of_planning_tournee.of_planning_intervention_view_form',  'map_view_ref': 'of_planning_tournee.of_planning_tour_line_small_map_drawroutes_view', 'active_tour_id': map_tour_id, 'additional_records': additional_records, 'additional_record_geojson_data': additional_record_geojson_data}"/>
                    </group>
                    <div style="float: left;">
                        <field name="map_description_html"/>
                    </div>
                </page>
            </xpath>
        </field>
    </record>
    <!-- End for : Views for the wizard called from the Partner/Task/Issue form-->
    <!-- End for : Views for the wizard called from the Partner/Task/Issue form-->
    <!-- End for : Views for the wizard called from the Partner/Task/Issue form-->


    <!-- Views for the lines of the wizard -->
    <!-- Views for the lines of the wizard -->
    <!-- Views for the lines of the wizard -->
    <record id="view_simple_of_tournee_rdv_line_wizard" model="ir.ui.view">
        <field name="name">view.simple.of.tournee.rdv.line.wizard</field>
        <field name="model">of.tournee.rdv.line</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Créneau">
                <script>
                    $(document).ready(function(){
                        // Cacher les boutons "Sauvegarder" et "Annuler" quand on clique sur un créneau du calendrier
                        var len = $(".modal-footer").length;
                        $(".modal-footer").eq(len-1).hide();
                    });
                </script>
                <field name="allday" invisible="1"/>
                <field name="intervention_id" invisible="1" readonly="1"/>
                <field name="selected" invisible="1" readonly="1"/>
                <group attrs="{'invisible':['|', ('allday', '!=', False), ('date', '=', False)]}">
                    <group>
                        <field name="date" readonly="1"/>
                        <field name="description" readonly="1"/>
                        <field name="employee_id" readonly="1"/>
                    </group>
                    <group>
                        <field name="distance_utile" readonly="1"/>
                        <field name="duree_utile" readonly="1"/>
                    </group>
                    <label for="selected_description" colspan="2" attrs="{'invisible':[('intervention_id','!=',False)]}"/>
                    <field name="selected_description" nolabel="1" colspan="2" attrs="{'invisible':[('intervention_id','!=',False)]}"/>
                </group>
                <div attrs="{'invisible':[('allday','!=',True)]}">
                    Ce créneau est virtuel. Il existe seulement pour montrer les limites de la recherche.
                </div>
                <div attrs="{'invisible':[('date','!=',False)]}">
                    Pour sélectionner ou voir les informations d'un créneau, veuillez cliquer dessus.
                </div>
                <footer attrs="{'invisible':[('date','=',False)]}">
                    <button name="action_select_confirm_slot" string="Confirm this slot" type="object" colspan="4" class="btn-primary"
                        attrs="{'invisible': ['|','|',('allday','!=',False),('intervention_id','!=',False),('selected','!=',False)]}"/>
                    <button name="button_confirm" string="Confirmer le RDV" type="object" colspan="4" class="btn-primary"
                        attrs="{'invisible': [('selected','!=',True)]}"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="view_simple_of_tournee_rdv_line_by_date_wizard" model="ir.ui.view">
        <field name="name">view.simple.of.tournee.rdv.line.by.date.wizard</field>
        <field name="model">of.tournee.rdv.line</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_simple_of_tournee_rdv_line_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="attributes">
                <attribute name="string">Créneau par date</attribute>
            </xpath>
        </field>
    </record>

    <record id="view_simple_of_tournee_rdv_line_by_distance_wizard" model="ir.ui.view">
        <field name="name">view.simple.of.tournee.rdv.line.by.distance.wizard</field>
        <field name="model">of.tournee.rdv.line</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_simple_of_tournee_rdv_line_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="attributes">
                <attribute name="string">Créneau par distance</attribute>
            </xpath>
        </field>
    </record>

    <record id="view_simple_of_tournee_rdv_line_by_duration_wizard" model="ir.ui.view">
        <field name="name">view.simple.of.tournee.rdv.line.by.duration.wizard</field>
        <field name="model">of.tournee.rdv.line</field>
        <field name="type">form</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="of_planning_tournee.view_simple_of_tournee_rdv_line_wizard"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="attributes">
                <attribute name="string">Créneau par durée</attribute>
            </xpath>
        </field>
    </record>
    <!-- End for : Views for the lines of the wizard -->
    <!-- End for : Views for the lines of the wizard -->
    <!-- End for : Views for the lines of the wizard -->

    <act_window
        name="Planifier une intervention"
        res_model="of.tournee.rdv"
        src_model="of.service"
        view_mode="form"
        view_id="view_rdv_intervention_wizard"
        id="action_view_rdv_intervention_wizard_service"
        target="new"
        groups="of_planning.group_planning_intervention_access"
    />

    <!-- Ajout bouton planifier une intervention dans vue form partenaire-->
    <record id="of_view_partner_form_rdv_intervention" model="ir.ui.view">
        <field name="name">res.partner.form.rdv.intervention</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="of_base.of_base_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="action_open_wizard_plan_intervention" string="Plan Intervention" type="object"
                        groups="of_planning.group_planning_intervention_access"/>
            </xpath>
        </field>
    </record>

    <!-- Ajout bouton planifier une intervention dans vue form service recurrent-->
    <record id="view_of_service_form_rdv_intervention" model="ir.ui.view">
        <field name="name">of.service.form.rdv.intervention</field>
        <field name="model">of.service</field>
        <field name="inherit_id" ref="of_service.view_of_service_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="action_open_wizard_plan_intervention" string="Plan Intervention"
                        type="object" invisible="context.get('hide_bouton_planif')"
                        attrs="{'invisible': [('base_state', '!=', 'calculated')]}"
                        groups="of_planning.group_planning_intervention_access"/>
            </xpath>
        </field>
    </record>

    <!-- Ajout bouton planifier une intervention dans vue form intervention #intervenception -->
    <record id="of_planning_intervention_view_form_rdv_intervention" model="ir.ui.view">
        <field name="name">of.planning.intervention.form.rdv.intervention</field>
        <field name="model">of.planning.intervention</field>
        <field name="inherit_id" ref="of_planning.of_planning_intervention_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header//button[@name='button_postponed']" position="after">
                <button name="action_open_wizard_plan_intervention" string="Plan Intervention"
                        type="object" invisible="context.get('hide_bouton_planif')"
                        attrs="{'invisible': [('state', '!=', 'postponed')]}"/>
            </xpath>
        </field>
    </record>
</odoo>
