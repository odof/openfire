<?xml version="1.0"?>
<odoo>

    <!--*****************************************************************************************-->
    <!--**************************************** Project ****************************************-->
    <!--*****************************************************************************************-->

    <record id="of_project_project_form_view" model="ir.ui.view">
        <field name="name">of_project.project.form.view</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet" position="before">
                <header>
                    <field name="of_state" widget="statusbar"/>
                </header>
            </xpath>
            <xpath expr="//h1" position="after">
                <field name="of_tag_ids" widget="many2many_tags" options="{'no_create_edit': True}"/>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="before">
                <field name="of_sale_id"/>
            </xpath>
        </field>
    </record>

    <record id="of_project_project_tree_view" model="ir.ui.view">
        <field name="name">of_project.project.tree.view</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="of_sale_id"/>
            </xpath>
        </field>
    </record>

    <record id="of_project_project_kanban_view" model="ir.ui.view">
        <field name="name">of_project.project.kanban.view</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="default_group_by">of_state</attribute>
            </xpath>
            <xpath expr="//field[@name='name']" position="before">
                <field name="of_state" invisible="1"/>
                <field name="of_tag_ids"/>
                <field name="partner_id"/>
                <field name="of_sale_id"/>
                <field name="description"/>
            </xpath>
            <xpath expr="//div[@class='o_kanban_card_content o_visible']" position="before">
                <div>
                    <field name="of_tag_ids" style="margin-left: -16px;"/>
                </div>
            </xpath>
            <xpath expr="//div[@class='o_primary']" position="after">
                <div name="partner">
                    <a name="get_partner_action" type="object">
                        <field name="partner_id"/>
                    </a>
                </div>
                <div name="sale_order">
                    <a name="get_sale_order_action" type="object">
                        <field name="of_sale_id"/>
                    </a>
                </div>
                <div name="description" t-if="record.description.raw_value" style="max-height:310px;overflow:hidden;text-overflow:ellipsis;">
                    <t t-raw="record.description.raw_value"/>
                </div>
            </xpath>
        </field>
    </record>

    <record id="of_project_project_timeline_view" model="ir.ui.view">
        <field name="name">of_project.project.timeline.view</field>
        <field name="model">project.project</field>
        <field name="type">timeline</field>
        <field name="arch" type="xml">
            <timeline date_start="of_start_date"
                      date_stop="of_end_date"
                      default_group_by="of_start_week"
            />
        </field>
    </record>

    <record id="of_project_project_search_view" model="ir.ui.view">
        <field name="name">of_project.project.search.view</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_project_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="before">
                <separator/>
                <!-- Vérifier dispo de use_issues -->
                <filter string="Projets Client" name="customer_projects"
                        domain="['&amp;', ('partner_id', '!=', False), '|', ('use_tasks', '=', True), ('use_issues', '=', True)]"/>
                <filter string="Projets Produit" name="product_projects"
                        domain="['&amp;', ('partner_id', '=', False), '|', ('use_tasks', '=', True), ('use_issues', '=', True)]"/>
                <separator/>
                <filter string="Ouverts" name="opened"
                        domain="[('of_state', '!=', '04_closed')]"/>
                <field name="of_state"/>
            </xpath>
            <xpath expr="//group" position="inside">
                <filter string="État" name="of_state" context="{'group_by': 'of_state'}"/>
                <filter string="Semaine de début" name="of_start_week" context="{'group_by': 'of_start_week'}"/>
            </xpath>
        </field>
    </record>

    <record id="project.open_view_project_all" model="ir.actions.act_window">
        <field name="view_mode">kanban,timeline,tree,form</field>
        <field name="context">{'search_default_opened': 1}</field>
    </record>

    <!--*****************************************************************************************-->
    <!--******************************************Project Task***********************************-->
    <!--*****************************************************************************************-->

    <record id="of_project_project_task_kanban_view" model="ir.ui.view">
        <field name="name">of_project.project.task.kanban.view</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="class">o_kanban_small_column</attribute>
                <attribute name="default_group_by">stage_id</attribute>
            </xpath>
         </field>
     </record>

    <record id="of_project_project_task_search_view" model="ir.ui.view">
        <field name="name">of_project.project.task.search.view</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form"/>
        <field name="arch" type="xml">
            <xpath expr="//group" position="before">
                <separator/>
                <filter string="Projets Client" name="customer_projects"
                        domain="[('project_id.partner_id', '!=', False)]"/>
                <filter string="Projets Produit" name="product_projects"
                        domain="[('project_id.partner_id', '=', False)]"/>
            </xpath>
        </field>
    </record>

</odoo>
