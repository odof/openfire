<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!-- #######################################################################################
                          PISTES & OPPORTUNITES (crm.lead, crm.stage)
############################################################################################ -->
        <!--
            crm.lead (as Lead) views
        -->

        <!-- Ajout dans le contexte "hide_sale: True" qui a été oublié par Odoo pour ne pas afficher les champs "Livré" et "Facturé" dans ligne de commande d'un devis affiché depuis le smart bottom "Devis" du pipeline
             ainsi que les philtres par défaut "devis ou devis envoyés" -->
        <record id="sale_crm.sale_action_quotations_new"  model="ir.actions.act_window">
            <field name="context">{'search_default_opportunity_id': active_id, 'default_opportunity_id': active_id, 'hide_sale': True, 'search_default_draft': 1, 'search_default_sent': 1}</field>
        </record>
        <record id="sale_crm.sale_action_quotations"  model="ir.actions.act_window">
            <field name="context">{'search_default_opportunity_id': active_id, 'default_opportunity_id': active_id, 'hide_sale': True, 'search_default_draft': 1, 'search_default_sent': 1}</field>
        </record>

        <!-- CRM Lead Form View  -->
        <record model="ir.ui.view" id="of_crm_case_form_view_leads">
            <field name="name">of.crm.lead.form - Leads</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_form_view_leads"/>
            <field name="arch" type="xml">
                <div class="o_address_format" position="after">
                    <field name="of_website" widget="url"/>
                </div>
            </field>
        </record>

        <!-- CRM Lead Tree View -->
        <record model="ir.ui.view" id="of_crm_case_tree_view_leads">
            <field name="name">of.crm.lead.tree - Leads</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_tree_view_leads"/>
            <field name="arch" type="xml">
                <field name="create_date" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>
                <field name="contact_name" position="after">
                    <field name="zip"/>
                    <field name="city"/>
                </field>
                <field name="country_id" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>
                <field name="email_from" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>
                <field name="phone" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>
                <field name="team_id" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>
                <field name="team_id" position="after">
                    <field name="priority"/>
                    <field name="tag_ids"/>
                </field>
            </field>
        </record>

        <!-- CRM Lead Search View -->
        <record id="of_view_crm_case_leads_filter" model="ir.ui.view">
            <field name="name">of.crm.lead.search - Leads</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_crm_case_leads_filter"/>
            <field name="arch" type="xml">
                <field name="name" position="after">
                    <field name="zip"/>
                    <field name="contact_name"/>
                    <field name="of_projet_line_ids" string="Projet"/>
                </field>
            </field>
        </record>

        <record id="of_crm_case_kanban_view_leads" model="ir.ui.view">
            <field name="name">of.crm.lead.kanban.lead</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
            <field name="arch" type="xml">
                <xpath expr="//kanban//field[@name='company_currency']" position="after">
                    <field name="of_customer_state"/>
                </xpath>
                <!-- ajout pastille prospect -->
                <xpath expr="//kanban//templates//div[@class='o_kanban_footer']//field[@name='priority']" position="after">
                    <div class="label label-success" attrs="{'invisible': [('of_customer_state', '!=', 'lead')]}">Prospect</div>
                    <div class="label label-info" attrs="{'invisible': [('of_customer_state', '!=', 'customer')]}">Client</div>
                </xpath>
            </field>
        </record>

        <!-- couleurs personnalisées -->
        <record  id="of_crm_case_calendar_view_leads" model="ir.ui.view">
            <field name="name">of.crm.lead.calendar.lead</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_calendar_view_leads"/>
            <field name="arch" type="xml">
                <xpath expr="//calendar" position="replace">
                    <calendar string="Leads Generation" date_start="date_action" color="user_id"
                      attendee_model="res.users" color_ft_field="of_color_ft" color_bg_field="of_color_bg" custom_colors="1">
                        <field name="name"/>
                        <field name="next_activity_id"/>
                        <field name="of_color_ft" invisible="1"/>
                        <field name="of_color_bg" invisible="1"/>
                        <field name="partner_name" invisible="1"/>
                    </calendar>
                </xpath>
            </field>
        </record>

        <!--####################### QUICK CREATE ##########################-->
        <record id="of_crm_view_create_opportunity_simplified" model="ir.ui.view">
            <field name="name">of.crm.lead.form.simple</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_create_opportunity_simplified"/>
            <field name="arch" type="xml">
                <!-- ##### Full sheet's modification ##### -->
                <xpath expr="//form//sheet" position="replace">
                    <sheet>
                        <field name="stage_probability" invisible="1"/>
                        <!-- Description revenu et probabilite -->
                        <h1>
                            <label string="Description" fonts="bold" class="oe_edit_only" />
                            <field name="name" placeholder="Description du Projet" modifiers="{'required': true}"/>
                        </h1>
                        <h2 class="o_row">
                            <div>
                                <label for="planned_revenue" string="Budget" class="oe_edit_only" />
                                <div class="o_row">
                                    <field name="company_currency" invisible="1"/>
                                    <field name="planned_revenue" widget='monetary' options="{'currency_field': 'company_currency'}"/>
                                    <span class="oe_grey">&#160;à&#160;</span>
                                </div>
                            </div>
                            <div>
                                <label for="probability" class="oe_edit_only"/>
                                <div class="o_row">
                                    <field name="probability" widget="integer"/>
                                    <span>%%</span>
                                </div>
                            </div>
                        </h2>

                        <!-- Corps -->
                        <group col="2">
                            <!-- Prospect group -->
                            <group name='prospect'>
                                <separator string="Prospect" colspan="2"/>
                                <field name="of_ref"/>
                                <field name="partner_id" domain="[('parent_id','=',False)]"/>
                                <label for="contact_name" string="Nom du Client"/>
                                <div>
                                    <div class="o_row " >
                                        <field name="contact_name"/>
                                        <field name="title" placeholder="Civilité" domain="[]"
                                          options="{'no_open': True}" can_create="true" can_write="true" modifiers="{}"
                                          attrs="{'invisible': [('contact_name', '=', False)]}"/>
                                    </div>
                                </div>
                                <field name="is_company"/>
                                <label for="street" string="Adresse"/>
                                <div class="o_address_format">
                                    <field name="street" placeholder="Adresse..." class="o_address_street"/>
                                    <field name="street2" placeholder="Adresse suite..." class="o_address_street"/>
                                    <field name="zip_id" options="{'no_open': True, 'no_create': True}" placeholder="City completion" class="oe_edit_only"/>
                                    <field name="city" placeholder="Ville" class="o_address_city"/>
                                    <field name="zip" placeholder="Code postal" class="o_address_zip"/>
                                    <field name="country_id" placeholder="Pays" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
                                </div>
                                <field name="phone" widget="phone" modifiers="{}"/>
                                <field name="mobile" widget="phone" modifiers="{}"/>
                                <field name="email_from" string="Courriel" widget="email" modifiers="{}"/>
                            </group>

                            <!-- Qualification et Suivi group -->
                            <group name='suivi'>
                                <separator string="Qualification et Suivi" colspan="2"/>
                                <label for="next_activity_id"/>
                                <div>
                                    <div class="o_row mr18">
                                        <field name="next_activity_id"
                                          options="{'no_create': True, 'no_open': True}"
                                          domain="['|',('team_id','=',False),('team_id','=',team_id)]"/>
                                        <span class="oe_form_field" attrs="{'invisible': ['|', ('next_activity_id', '=', False), ('date_action', '=', False)]}">
                                            &#160;Date
                                        </span>
                                        <field name="date_action" attrs="{'invisible': [('next_activity_id', '=', False)]}" placeholder="Date..."/>
                                    </div>
                                    <div>
                                        <field name="title_action" placeholder="Ex. Proposition d'examen"
                                          attrs="{'invisible': [('next_activity_id', '=', False)]}"/>
                                    </div>
                                </div>

                                <field name="of_date_prospection" string="Date de création"/>
                                <field name="date_deadline" string="Date du projet"/>
                                <field name="of_date_cloture"/>
                                <field name="company_id"/>
                                <field name="priority" widget="priority"/>
                                <field name="tag_ids" widget="many2many_tags" options="{'no_create_edit': True}"/>
                                <field name="user_id" domain="[('share', '=', False)]" string="Commercial"
                                  context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'sales_team.group_sale_salesman_all_leads'], 'team_id': team_id}"/>
                                <field name="of_prospecteur_id"/>
                                <field name="lost_reason" attrs="{'invisible': [('stage_probability', '!=', 0)]}"/>

                                <!-- Invisible champs -->
                                <field name="team_id" invisible="1"/>
                                <field name="date_conversion" invisible="1"/>
                            </group>
                        </group>

                        <!-- Onglets -->
                        <notebook colspan="4">

                            <!-- Suivi -->
                            <page string="Suivi" >
                                <field name="description" widget="html"/>
                            </page>

                            <!-- Contact -->
                            <page name="lead" string="Contact">
                                <group>
                                    <group string="Géolocalisation" name="geoloc">
                                        <field name="geo_lat"/>
                                        <field name="geo_lng"/>
                                    </group>

                                    <group string="Options" name="options">
                                        <!-- option de retrait -->
                                        <field name="opt_out"/>
                                    </group>

                                    <group string="Marketing">
                                        <field name="campaign_id" />
                                        <field name="medium_id" string="Canal"/>
                                        <field name="source_id" />
                                    </group>

                                    <group string="Misc" name="Misc">
                                        <field name="referred" />
                                    </group>
                                </group>
                            </page>

                            <!-- Projet -->
                            <page name="lead" string="Projet">
                                <group>
                                    <field name="of_modele_id" string="Projet" widget="selection"/>
                                </group>

                                <field name="of_projet_line_ids" nolabel="1" mode="kanban">
                                    <form>
                                        <group>
                                            <field name="type" invisible="1"/>
                                            <field name="attr_id" widget="selection"/>
                                            <field name="name"/>
                                            <field name="val_bool" attrs="{'invisible': [('type','!=','bool')]}"/>
                                            <field name="val_date" attrs="{'invisible': [('type','!=','date')]}"/>
                                            <field name="val_char" attrs="{'invisible': [('type','!=','char')]}"/>
                                            <field name="val_text" attrs="{'invisible': [('type','!=','text')]}"/>
                                            <field name="val_select_id" options="{'no_create': True}" attrs="{'invisible': [('type','!=','selection')]}" domain="[('attr_id','=',attr_id)]"/>
                                            <!--field name="val_select_ids" widget="many2many_tags" attrs="{'invisible': [('type','!=','multiple')]}" domain="[('attr_id','=',attr_id)]"/-->
                                            <field name="sequence"/>
                                        </group>
                                    </form>
                                </field>
                            </page>

                            <!-- Autres infos -->
                            <page name="infos_compl" string="Autres infos">
                                <field name="of_infos_compl" nolabel="1" widget="html"/>
                            </page>
                        </notebook>
                        <footer>
                            <button string="Create" name="close_dialog" type="object" class="btn-primary"/>
                            <button string="Discard" class="btn-default" special="cancel"/>
                        </footer>
                    </sheet>
                </xpath>
            </field>
        </record>

        <!--
            crm.lead (as Opportunity) views
        -->
        <record id="of_crm_case_form_view_oppor" model="ir.ui.view">
            <field name="name">of.crm.lead.form.opportunity</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
            <field name="arch" type="xml">
                <!-- Modifications header -->
                <xpath expr="//form//header//button[@name='action_set_won']" position="attributes">
                    <attribute name="attrs">{'invisible': [('probability', 'in', (0,100))]}</attribute>
                </xpath>
                <xpath expr="//form//header//button[@type='action'][@class='oe_highlight'][2]" position="attributes">
                    <attribute name="attrs">{'invisible': [('probability', 'in', (0,100))]}</attribute>
                </xpath>
                <!-- ##### Full sheet's modification ##### -->
                <xpath expr="//form//sheet" position="replace">
                    <sheet>
                        <group name="title_and_buttons" >
                            <div class="oe_title of_width_200" >
                                <!-- Étiquettes Gagné/Perdu (vues conditionnelles) -->
                                <field name="stage_probability" invisible="1"/>
                                <div class="label label-danger pull-right" attrs="{'invisible': [('stage_probability', '&gt;', 0)]}" >Perdu</div>
                                <div class="label label-info pull-right" attrs="{'invisible': [('stage_probability', '&lt;', 100)]}" >Gagné</div>

                                <!-- Titre -->
                                <separator string="Opportunité"  />
                            </div>

                            <!-- Boutons -->
                            <div class="oe_button_box of_width_600" name="button_box_custom" >
                                <!-- Bouton Actif -->
                                <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive" display="inline-block">
                                    <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
                                </button>

                                <!-- Bouton Reunion  -->
                                <button class="oe_stat_button" type="object" display="inline-block"
                                  context="{'partner_id': partner_id}"
                                  name="action_schedule_meeting" icon="fa-calendar">
                                    <div class="o_stat_info">
                                        <field name="meeting_count" class="o_stat_value"/>
                                        <span class="o_stat_text" attrs="{'invisible': [('meeting_count', '&lt;', 2)]}"> Réunions</span>
                                        <span class="o_stat_text" attrs="{'invisible': [('meeting_count', '&gt;', 1)]}"> Réunion</span>
                                    </div>
                                </button>

                                <!-- Bouton Devis -->
                                <button class="oe_stat_button" type="action" display="inline-block"
                                  name="%(sale_crm.sale_action_quotations)d" icon="fa-pencil-square-o"
                                  context="{'default_partner_id': partner_id, 'search_default_draft': 1}">
                                    <div class="o_stat_info">
                                        <field name="sale_number" class="o_stat_value" modifiers="{'readonly': true}"/>
                                        <span class="o_stat_text"> Devis</span>
                                    </div>
                                </button>

                                <!-- Bouton Ordres (vue conditionnelle) -->
                                <button class="oe_stat_button" type="action" display="inline-block"
                                  attrs="{'invisible': [('sale_amount_total', '=', 0)]}" name="%(sale_crm.sale_action_quotations)d" icon="fa-usd"
                                  context="{'search_default_partner_id': partner_id, 'default_partner_id': partner_id, 'search_default_sales': 1}"
                                  modifiers="{'invisible': [['sale_amount_total', '=', 0]]}">
                                    <div class="o_form_field o_stat_info">
                                        <span class="o_stat_value">
                                            <field name="sale_amount_total" widget="monetary"
                                              options="{'currency_field': 'company_currency'}" modifiers="{'readonly': true}"/>
                                        </span>
                                        <span class="o_stat_text"> Ordres</span>
                                    </div>
                                </button>
                            </div>
                        </group>

                        <!-- Description revenu et probabilite -->
                        <h1>
                            <label string="Description" fonts="bold" class="oe_edit_only"/>
                            <field name="name" placeholder="Description du Projet" modifiers="{'required': true}"/>
                        </h1>
                        <h2 class="o_row">
                            <div>
                                <label for="planned_revenue" string="Budget" class="oe_edit_only" />
                                <div class="o_row">
                                    <field name="company_currency" invisible="1"/>
                                    <field name="planned_revenue" widget='monetary' options="{'currency_field': 'company_currency'}"/>
                                    <span class="oe_grey">&#160;à&#160;</span>
                                </div>
                            </div>
                            <div>
                                <label for="probability" class="oe_edit_only"/>
                                <div class="o_row">
                                    <field name="probability" widget="integer"/>
                                    <span>%%</span>
                                </div>
                            </div>
                        </h2>

                        <!-- Corps -->
                        <group col="2">
                            <!-- Prospect group -->
                            <group name='prospect'>
                                <separator string="Prospect" colspan="2"/>
                                <field name="of_ref"/>
                                <field name="partner_id" domain="[('parent_id','=',False)]"/>
                                <label for="contact_name" string="Nom du Client"/>
                                <div>
                                    <div class="o_row " >
                                        <field name="contact_name"/>
                                        <field name="title" placeholder="Civilité" domain="[]"
                                               options="{'no_open': True}" can_create="true" can_write="true" modifiers="{}"
                                               attrs="{'invisible': [('contact_name', '=', False)]}"/>
                                    </div>
                                </div>
                                <field name="is_company"/>
                                <label for="street" string="Adresse"/>
                                <div class="o_address_format">
                                    <field name="street" placeholder="Adresse..." class="o_address_street"/>
                                    <field name="street2" placeholder="Adresse suite..." class="o_address_street"/>
                                    <field name="zip_id" options="{'no_open': True, 'no_create': True}" placeholder="City completion" class="oe_edit_only"/>
                                    <field name="city" placeholder="Ville" class="o_address_city"/>
                                    <field name="zip" placeholder="Code postal" class="o_address_zip"/>
                                    <field name="country_id" placeholder="Pays" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
                                </div>
                                <field name="phone" widget="phone" modifiers="{}"/>
                                <field name="mobile" widget="phone" modifiers="{}"/>
                                <field name="email_from" string="Courriel" widget="email" modifiers="{}"/>
                            </group>

                            <!-- Qualification et Suivi group -->
                            <group name='suivi'>
                                <separator string="Qualification et Suivi" colspan="2"/>
                                <label for="next_activity_id"/>
                                <div>
                                    <div class="o_row mr18">
                                        <field name="next_activity_id" options="{'no_create': True, 'no_open': True}"
                                          domain="['|',('team_id','=',False),('team_id','=',team_id)]"/>
                                        <span class="oe_form_field" attrs="{'invisible': ['|', ('next_activity_id', '=', False), ('date_action', '=', False)]}">
                                            &#160;Date
                                        </span>
                                        <field name="date_action" attrs="{'invisible': [('next_activity_id', '=', False)]}" placeholder="Date..."/>
                                    </div>
                                    <div>
                                        <field name="title_action" placeholder="Ex. Proposition d'examen"
                                          attrs="{'invisible': [('next_activity_id', '=', False)]}"/>
                                    </div>
                                </div>

                                <field name="of_date_prospection" string="Date de création" />
                                <field name="date_deadline" string="Date du projet"/>
                                <field name="of_date_cloture"/>
                                <field name="company_id"/>
                                <field name="priority" widget="priority"/>
                                <field name="tag_ids" widget="many2many_tags" options="{'no_create_edit': True}"/>
                                <field name="user_id" domain="[('share', '=', False)]" string="Commercial"
                                  context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'sales_team.group_sale_salesman_all_leads'], 'team_id': team_id}"/>
                                <field name="of_prospecteur_id"/>
                                <field name="lost_reason" attrs="{'invisible': [('stage_probability', '!=', 0)]}"/>

                                <!-- Invisible champs -->
                                <field name="team_id" invisible="1"/>
                                <field name="date_conversion" invisible="1"/>
                            </group>
                        </group>

                        <!-- Onglets -->
                        <notebook colspan="4">

                            <!-- Suivi -->
                            <page string="Suivi" >
                                <field name="description" widget="html"/>
                            </page>

                            <!-- Contact -->
                            <page name="lead" string="Contact">
                                <group>
                                    <group string="Géolocalisation" name="geoloc">
                                        <field name="geo_lat"/>
                                        <field name="geo_lng"/>
                                        <field name="precision"/>
                                    </group>

                                    <group string="Options" name="options">
                                        <!-- option de retrait -->
                                        <field name="opt_out"/>
                                    </group>

                                    <group string="Marketing">
                                        <field name="campaign_id" />
                                        <field name="medium_id" string="Canal"/>
                                        <field name="source_id" />
                                    </group>

                                    <group string="Misc" name="Misc">
                                        <field name="referred" />
                                    </group>
                                </group>
                            </page>

                            <!-- Projet -->
                            <page name="lead" string="Projet">
                                <group>
                                    <field name="of_modele_id" string="Projet" widget="selection"/>
                                </group>
 
                                <!--label for="of_projet_line_ids"/-->
                                <field name="of_projet_line_ids" nolabel="1" mode="kanban">
                                    <form>
                                        <group>
                                            <field name="type" invisible="1"/>
                                            <field name="attr_id" widget="selection"/>
                                            <field name="name"/>
                                            <field name="val_bool" attrs="{'invisible': [('type','!=','bool')]}"/>
                                            <field name="val_date" attrs="{'invisible': [('type','!=','date')]}"/>
                                            <field name="val_char" attrs="{'invisible': [('type','!=','char')]}"/>
                                            <field name="val_text" attrs="{'invisible': [('type','!=','text')]}"/>
                                            <field name="val_select_id" options="{'no_create': True}" attrs="{'invisible': [('type','!=','selection')]}" domain="[('attr_id','=',attr_id)]"/>
                                            <!--field name="val_select_ids" widget="many2many_tags" attrs="{'invisible': [('type','!=','multiple')]}" domain="[('attr_id','=',attr_id)]"/-->
                                            <field name="sequence"/>
                                        </group>
                                    </form>
                                </field>
                            </page>

                            <!-- Autres infos -->
                            <page name="infos_compl" string="Autres infos">
                                <field name="of_infos_compl" nolabel="1" widget="html"/>
                            </page>
                        </notebook>
                    </sheet>

                    <!-- Mail et chat -->
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                <!--/form-->
                </xpath>
            </field>
        </record>

        <!-- vue liste des opportunités -->
        <record id="of_crm_case_tree_view_oppor" model="ir.ui.view">
            <field name="name">crm.lead.tree.opportunity</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_tree_view_oppor"/>
            <field name="arch" type="xml">
                <!-- Retrait des affichages pays et équipe commerciale -->
                <xpath expr="//tree//field[@name='country_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//tree//field[@name='team_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <!-- Simplification des titres -->
                <xpath expr="//tree//field[@name='create_date']" position="attributes">
                    <attribute name="string">Date</attribute>
                </xpath>
                <xpath expr="//tree//field[@name='date_action']" position="attributes">
                    <attribute name="string">Date Action</attribute>
                </xpath>
                <xpath expr="//tree//field[@name='title_action']" position="attributes">
                    <attribute name="string">Résumé Action</attribute>
                </xpath>
                <!-- Ajout du nom de l'activité suivante -->
                <xpath expr="//tree//field[@name='date_action']" position="after">
                    <field name="next_activity_id" string="Action"/>
                </xpath>
            </field>
        </record>

        <!-- vue liste des prochaines activités -->
        <record id="of_crm_lead_view_tree_activity" model="ir.ui.view">
            <field name="name">of.crm.lead.tree.opportunity.next.activity</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_lead_view_tree_activity"/>
            <field name="arch" type="xml">
                <!-- changement des noms de colonnes -->
                <xpath expr="//tree//field[@name='date_action']" position="attributes">
                    <attribute name="string">Date</attribute>
                </xpath>
                <xpath expr="//tree//field[@name='next_activity_id']" position="attributes">
                    <attribute name="string">Activité</attribute>
                </xpath>
                <xpath expr="//tree//field[@name='title_action']" position="attributes">
                    <attribute name="string">Résumé</attribute>
                </xpath>
                <xpath expr="//tree//field[@name='planned_revenue']" position="attributes">
                    <attribute name="string">Budget</attribute>
                </xpath>
                <xpath expr="//tree//field[@name='date_deadline']" position="attributes">
                    <attribute name="string">Date Projet</attribute>
                </xpath>
            </field>
        </record>

        <record id="of_view_crm_case_opportunities_filter" model="ir.ui.view">
            <field name="name">of.crm.lead.search - Opportunities</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
            <field name="arch" type="xml">
                <field name="name" position="after">
                    <field name="zip"/>
                    <field name="contact_name"/>
                    <field name="of_projet_line_ids" string="Projet"/>
                    <!-- on utilise le champ 'name' car il nous fallait un champ texte -->
                    <field name="name" string="Marque" filter_domain="[('of_projet_line_ids','ilike','Marque:'+self)]"/>
                    <field name="company_id"/>
                </field>
            </field>
        </record>

        <!-- delete model="ir.ui.menu" id="crm.menu_crm_lead_categ"/>  -->

        <record id="of_crm_stage_form" model="ir.ui.view">
            <field name="name">of.crm.stage.form</field>
            <field name="model">crm.stage</field>
            <field name="inherit_id" ref="crm.crm_stage_form"/>
            <field name="priority" eval="1"/>
            <field name="arch" type="xml">
                <!-- rendre la probabilité toujours visible-->
                <xpath expr="//form//field[@name='probability']" position="attributes">
                    <attribute name="attrs"></attribute>
                </xpath>
            </field>
        </record>

        <!-- ########## Ajout vue map ########## -->

        <record id="of_crm_map_view" model="ir.ui.view">
            <field name="name">of.crm.map</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <map string="Map" class="o_crm_lead_map" latitude_field="geo_lat" longitude_field="geo_lng" color_field="of_color_map">
                    <field name="active" invisible="1"/>
                    <field name="of_color_map" required="1"/>
                    <field name="geo_lat" required="1"/>
                    <field name="geo_lng" required="1"/>
                    <field name="precision"/>
                    <field name="id"/>
                    <field name="name"/>
                    <field name="contact_name"/>
                    <field name="zip"/>
                    <field name="city"/>
                    <field name="phone"/>
                    <field name="mobile"/>
                    <field name="next_activity_name"/>
                    <field name="date_action"/>
                    <field name="tag_ids"/>
                    <templates>
                        <t t-name="of_map_record_box">
                            <div t-attf-class="#{map_record_color(record.of_color_map.raw_value)} of_map_record_global_click"><!-- TODO: gestion couleur -->
                                <div class="of_map_record_buttons">
                                    <i class="of_map_record_close fa fa-lg fa-times"/>
                                    <!--i class="of_map_record_min fa fa-lg fa-minus"/>  later implementation...
                                    <i class="of_map_record_max fa fa-lg fa-square"/-->
                                </div>
                                <div name="content" class="of_map_record_content">
                                    <t t-if="record.name.raw_value != record.partner_name.raw_value">
                                        <strong><field name="name"/></strong><br/>
                                    </t>
                                    <t t-if="record.partner_name.raw_value">
                                        <i class="fa fa-user"/><span class="of_ws"/>
                                        <strong><field name="partner_name"/></strong><br/>
                                    </t>
                                    <t t-if="record.city.raw_value">
                                        <i class="fa fa-map-marker"/><span class="of_ws"/>
                                        <field name="zip"/><span class="of_ws"/>
                                        <field name="city"/><br/>
                                    </t>
                                    <t t-if="record.phone.raw_value">
                                        <i class="fa fa-phone"/><span class="of_ws"/>
                                        <field name="phone"/><br/>
                                    </t>
                                    <t t-if="record.mobile.raw_value">
                                        <i class="fa fa-phone"/><span class="of_ws"/>
                                        <field name="mobile"/><br/>
                                    </t>
                                    <t t-if="record.date_action.raw_value">
                                        <i class="fa fa-calendar-o"/><span class="of_ws"/>
                                        <field name="next_activity_name"/><span class="of_ws"/>
                                        <field name="date_action"/><br/>
                                    </t>
                                    <t t-if="record.tag_ids.raw_value">
                                        <field name="tag_ids" of_options='{"exclude_vals": ["client","prospect"]}'/>
                                    </t>
                                </div>
                            </div>
                        </t>
                        <t t-name="of_map_marker_tooltip">
                            <div name="marker_tooltip">
                                <field name="name"/><br/>
                                Précision:
                                <t t-if='["manual","high","medium","low"].includes(record.precision.raw_value)'>
                                    <field name="precision"/>
                                </t>
                                <t t-else="">
                                    <span class="of_ws"/>
                                    Indeterminée
                                </t>
                            </div>
                        </t>
                    </templates>
                </map>
            </field>
        </record>

        <!-- Ajout vue map. Cette action est utilisée quand l'utilisateur rafraîchit la page 'votre pipeline' -->
        <record model="ir.actions.act_window" id="crm.crm_lead_opportunities_tree_view">
            <field name="view_mode">kanban,tree,graph,pivot,form,calendar,map</field>
            <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'kanban', 'view_id': ref('crm.crm_case_kanban_view_leads')}),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('crm.crm_case_tree_view_oppor')}),
                          (0, 0, {'view_mode': 'map', 'view_id': ref('of_crm_map_view')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('crm.crm_case_form_view_oppor')}),
                          (0, 0, {'view_mode': 'calendar'}),
                          (0, 0, {'view_mode': 'pivot'}),
                          (0, 0, {'view_mode': 'graph'})]"/>
            <field name="context">{
                    'default_type': 'opportunity',
                    'default_user_id': uid,
            }</field>
        </record>


<!-- #######################################################################################
                                        VENTES
############################################################################################ -->
        <record id="of_crm_view_order_form" model="ir.ui.view">
            <field name="name">of.crm.sale.order.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_crm.sale_view_inherit123"/>
            <field name="arch" type="xml">
                <xpath expr="//form//sheet//notebook//group[@name='technical']/../.." position="attributes">
                    <!-- donner le nom 'other_info' à la page concernée-->
                    <attribute name="name">other_info</attribute>
                </xpath>
                <xpath expr="//form//sheet//notebook//group[@name='technical']" position="attributes">
                    <!-- ouvrir visibilité en dehors de mode développeur-->
                    <attribute name="groups">sales_team.group_sale_salesman</attribute>
                </xpath>
                <xpath expr="//form//sheet//notebook//group[@name='technical']//field[@name='opportunity_id']" position="attributes">
                    <!-- ouvrir visibilité en dehors de mode développeur-->
                    <attribute name="groups">sales_team.group_sale_salesman</attribute>
                </xpath>
            </field>
        </record>

<!--########################################################################################
                                       PARTENAIRES
############################################################################################ -->
        <record id="of_crm_view_partner_form" model="ir.ui.view">
            <field name="name">of.crm.res.partner.form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <!-- label 'prospect' -->
                <xpath expr="//form//div[@class='oe_title']//div[@class='o_row']" position="inside">
                    <div class="label label-success" attrs="{'invisible': [('of_customer_state', '!=', 'lead')]}">Prospect</div>
                </xpath>
                <xpath expr="//form//notebook//page[@name='sales_purchases']//field[@name='customer']" position="after">
                    <field name="of_customer_state" attrs="{'invisible': [('customer', '=', False)]}"/>
                </xpath>
                <field name="user_id" position="after">
                    <field name="of_prospecteur_id"/>
                </field>
            </field>
        </record>

        <!-- Partner Kanban View -->
        <record model="ir.ui.view" id="of_crm_res_partner_kanban_view">
            <field name="name">of.crm.res.partner.kanban</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.res_partner_kanban_view"/>
            <field name="arch" type="xml">
                <xpath expr="//kanban//field[@name='type']" position="after">
                    <field name="of_customer_state"/>
                </xpath>
                <xpath expr="//kanban//templates//strong[@class='oe_partner_heading']" position="after">
                    <div t-if="record.of_customer_state.raw_value == 'lead'" class="label label-success">prospect</div>
                </xpath>
            </field>
        </record>

        <record id="of_crm_view_partner_tree" model="ir.ui.view">
            <field name="name">of.crm.res.partner.tree</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_tree"/>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <xpath expr="//tree" position="inside">
                    <field name="of_customer_state" invisible="1"/>
                </xpath>
                <!--prospects en bleu clair -->
                <xpath expr="//tree" position="attributes">
                    <attribute name="colors">#5cb85c: of_customer_state=='lead';</attribute>
                </xpath>
            </field>
        </record>

        <record id="of_crm_view_res_partner_filter" model="ir.ui.view">
            <field name="name">res.partner.select</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="of_geolocalize.of_view_res_partner_filter"/>
            <field name="arch" type="xml">
                <!-- filtres prospects et signés -->
                <xpath expr="//search//filter[@name='not_localized']" position="before">
                    <filter string="Clients signés" name="confirmed" domain="[('customer','=',1), ('parent_id', '=', False), ('of_customer_state', '=', 'customer')]"/>
                    <filter string="Prospects" name="lead" domain="[('customer','=',1), ('parent_id', '=', False), ('of_customer_state', '=', 'lead')]"/>
                    <separator/>
                </xpath>
                <field name="user_id" position="after">
                    <field name="of_prospecteur_id"/>
                </field>
            </field>
        </record>

        <record id="base.action_partner_form" model="ir.actions.act_window">
            <field name="name">Customers</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.partner</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{"search_default_confirmed": 1}</field>
            <field name="search_view_id" ref="of_crm_view_res_partner_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
              </p><p>
                Odoo helps you easily track all activities related to
                a customer: discussions, history of business opportunities,
                documents, etc.
              </p>
            </field>
        </record>

        <record id="of_crm_action_prospect_form" model="ir.actions.act_window">
            <field name="name">Prospects</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.partner</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{"search_default_lead": 1}</field>
            <field name="search_view_id" ref="of_crm_view_res_partner_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
              </p><p>
                Odoo helps you easily track all activities related to
                a prospect: discussions, history of business opportunities,
                documents, etc.
              </p>
            </field>
        </record>

        <menuitem id="of_crm_menu_prospect_form"
            action="of_crm_action_prospect_form"
            parent="sales_team.menu_sales"
            name="Prospects"
            sequence="3"/>


<!-- #######################################################################################
                                      SOCIETES
############################################################################################ -->

        <record id="of_crm_view_company_form" model="ir.ui.view">
            <field name="name">of.crm.company.form</field>
            <field name="model">res.company</field>
            <field name="inherit_id" ref="of_base.of_base_view_company_form"/>
            <field name="arch" type="xml">
                <xpath expr="//notebook//page[@name='advanced_settings']" position="attributes">
                    <attribute name="invisible">0</attribute>
                </xpath>
                <xpath expr="//notebook//page[@name='advanced_settings']/group[@name='advanced_settings_group_2']" position="inside">
                    <group colspan="2">
                        <separator string="CRM" colspan="2"/>
                        <field name="crm_suivi"/>
                        <field name="crm_suivi_notes"/>
                    </group>
                </xpath>
            </field>
        </record>

</odoo>
